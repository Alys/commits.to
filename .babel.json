{
  "{\"filename\":\"/app/server.js\",\"env\":{},\"retainLines\":false,\"highlightCode\":true,\"suppressDeprecationMessages\":false,\"presets\":[],\"plugins\":[[[],null],[[],null],[[],null],[[],{\"loose\":false,\"spec\":false}],[[],null],[[],null],[[],{\"spec\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"async\":false,\"asyncGenerators\":false}]],\"ignore\":[],\"code\":true,\"metadata\":true,\"ast\":true,\"comments\":true,\"compact\":\"auto\",\"minified\":false,\"sourceRoot\":\"/app\",\"babelrc\":true,\"sourceType\":\"module\",\"moduleIds\":false,\"passPerPreset\":false,\"parserOpts\":false,\"generatorOpts\":false}:6.26.0": {
    "metadata": {
      "usedHelpers": [],
      "marked": [],
      "modules": {
        "imports": [],
        "exports": {
          "exported": [],
          "specifiers": []
        }
      }
    },
    "options": {
      "filename": "/app/server.js",
      "filenameRelative": "/app/server.js",
      "env": {},
      "retainLines": false,
      "highlightCode": true,
      "suppressDeprecationMessages": false,
      "presets": [],
      "plugins": [
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false,
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "async": false,
            "asyncGenerators": false
          }
        ]
      ],
      "ignore": [],
      "code": true,
      "metadata": true,
      "ast": false,
      "comments": true,
      "compact": "auto",
      "minified": false,
      "sourceMaps": "both",
      "sourceMapTarget": "server.js",
      "sourceFileName": "server.js",
      "sourceRoot": "/app",
      "babelrc": false,
      "sourceType": "module",
      "moduleRoot": "/app",
      "moduleIds": false,
      "passPerPreset": false,
      "parserOpts": false,
      "generatorOpts": false,
      "basename": "server"
    },
    "ignored": false,
    "code": "'use strict';\n\n// --------------------------------- 80chars ---------------------------------->\nvar express = require('express');\nvar Sequelize = require('sequelize');\nvar app = express();\nvar chrono = require('chrono-node'); // Sugar.js parses some things better\nvar Mailgun = require('mailgun-js');\nvar moment = require('moment');\n\n// DATABASE FIELDS:\n//   urtx -- urtext, ie, full original text the user typed to create the promise\n//   user -- who's making the promise\n//   what -- what's being promised\n//   whom -- to whom are you promising\n//   tini -- unixtime that the promise was made\n//   tdue -- unixtime that the promise is due\n//   tmzn -- timezone assumed for parsing the deadline\n//   tfin -- unixtime that the promise was fulfilled\n//   fill -- fraction fulfilled, default 0\n//   void -- true if the promise became unfulfillable or moot\n//   clix -- number of clicks a promise has gotten\n// For example:\n//   urtx = \"bob.promises.to/foo_the_bar/by/noon_tomorrow\"\n//   user = \"bob\"\n//   what = \"foo the bar\"\n//   whom = null\n//   tini = [unixtime of first GET request of the promise's URL]\n//   tdue = [what \"noon tomorrow\" parsed to at time tini]\n//   tmzn = \"America/Los_Angeles\"\n//   tfin = [unixtime that the promise was fulfilled]\n//   fill = 0\n//   void = false\n\n// Other ideas for fields: \n// * information about the client that originally created the promise\n// * whether the promise was created by the actual user (if they were logged in \n//   and were the first to click on it) or by another logged-in user or by \n//   someone not logged in\n// * conf: maybe we create the promise whether or not anyone clicks the button to confirm\n//   it, in which case we store when it's actually been confirmed.\n\n// LATEST SPEC:\n// The \"/by/...\" part is an optional power-user thing, not part of the MVP.\n// Instead, the first time you go to alice.promises.to/foo it gives you the \n// option to choose a deadline, defaulting to now+7days (or to what the \"/by/\" \n// part parsed to, if that's easy, but just make it a suggestion for the user, \n// just like now+7days is if they don't specify a \"/by/\"). \n// For every subsequent GET of alice.promises.to/foo it shows the deadline, with\n// no way to change it.\n\n// IDEAS FOR LATER:\n// Simpler date parsing:\n//   Maybe the date has to be YYYY-MM-DD_HH:MM\n//   Example: bob.promises.to/foo_the_bar/by/2017-09-13_12:00\n// Magic spaces:\n//   Whichever non-alphanumeric character is most common in the urtext, that's \n//   what's assumed to be a space and is replaced with spaces before parsing.\n// Less magical version:\n//   A non-alphanumeric character must follow \"alice.promises.to/\" and that\n//   character is taken as the ersatz space. Eg:\n//   alice.promises.to/_start_her_promises_with_underscores\n// Flexibility on the '/by/' part:\n//   Requiring the string '/by/' to appear in the promise URL means no ambiguity\n//   about where to start parsing the deadline. But the Chrono parsing library \n//   actually does great taking the whole string like \"foo the bar by noon \n//   tomorrow\" and figuring out the time. We could also just take the last\n//   occurrence of \"by\" and parse everything after it as the deadline.\n\napp.use(express.static('public'));\n\nfunction mailself(subj, body) {\n  var mailgun = new Mailgun({ apiKey: process.env.MAILGUN_KEY,\n    domain: process.env.MAILGUN_DOMAIN });\n  var data = {\n    from: process.env.MAILGUN_FROM,\n    to: process.env.MY_EMAIL,\n    subject: subj,\n    text: body\n  };\n  mailgun.messages().send(data, function (err, body) {});\n}\n\n// Take urtext and return a promise data structure\nfunction parseProm(urtx) {\n  var m = urtx.match(/^([^\\.]+)\\.(promises|commits)\\.to\\/(.*)$/);\n  // TODO: handle the case that no user is given, just \"promises.to/foo\"\n  var user = m ? m[1] : '';\n  var domain = m ? m[2] : '';\n  var path = m ? m[3] : '';\n  var what = '';\n  var tdue = Date.now() + 7 * 24 * 60 * 60 * 1000;\n  if (path.length > 0) {\n    var parsedPath = path.match(/^(.*?)(\\/by\\/|$)(.*)$/);\n    what = parsedPath[1]; //.replace(/_/g, ' ')\n    //tdue = parsedPath.length > 1 ? \n    //       chrono.parseDate(parsedPath[3].replace(/_/g, ' ')) * 1 : \n    //       Date.now() + 7*24*60*60*1000\n    //tdue = tdue ? ( ( tdue < Date.now() && Date.now() - tdue < 24*60*60*1000 ) ?\n    //                tdue + 24*60*60*1000 : tdue )\n    //            : Date.now() + 7*24*60*60*1000\n    tdue = parsedPath[3];\n  }\n  // TODO: path is now everything after \".promises.to\" so now parse out the \n  //       \"what\" (thing being promised) and the \"tdue\" (deadline)\n  console.log('parseProm', { user: user, path: path, domain: domain, what: what, tdue: tdue, urtx: urtx });\n  return { user: user, path: path, domain: domain, what: what, tdue: tdue, urtx: urtx, tini: Date.now() };\n}\n\n// Compute the credit you get for being t seconds late\nfunction credit(t) {\n  // see latepenalty.js\n  return 1;\n}\n\n// Initial promise list hardcoded so don't have to worry about blowing db away\nvar promises = [\"alice.promises.to/File_the_TPS_report/by/noon_mon\", \"bob.promises.to/Send_vacation_photos/by/saturday\", \"carol.promises.to/Call_the_dentist/by/12am\", \"dreev.promises.to/show_sergii_this_doing_something_useful/by/3am\", // 9-10, done\n\"dreev.promises.to/show_bee_open_questions/by/10:30pm\", // 9-10, done\n\"braden.promises.to/help_with_javascript/by/5pm\", // 9-11\n\"dreev.promises.to/show_brennan_intro/by/10:50pm\", // 9-11, done\n\"dreev.promises.to/queue_tweet_etc_for_blog_post/by/2pm\", // 9-11, done\n\"dreev.promises.to/order_indian/by/5:30pm\", // 9-12, done\n\"dreev.commits.to/ask_bee_re_sunday_parkways\", // 9-13, done\n\"dreev.commits.to/follow_up_with_everyone_re_guest_blogging\", // 9-13\n\"josh.commits.to/get_realisies_running/by/september_30\", // 9-13\n\"braden.commits.to/outline_bite_counting_post/by/Sunday_11pm\", // 9-13\n\"dreev.commits.to/report_glitch_bug\", // 9-14\n\"dreev.commits.to/googledocify_intern_form/by/12pm\", // 9-14\n\"dreev.promises.to/test_penalty_func/by/saturday_noon\", // 9-14\n\"sergii.promises.to/work_on_points_2_to_4/by/next_monday\", // 9-14\n\"dreev.commits.to/meta_debrief_kim/by/midnight_friday\", // 9-14\n\"dreev.commits.to/ping_mirabai/by/sep_22\", // 9-14\n\"dreev.commits.to/send_ms_gross_email/by/sunday_11am\", // 9-14\n\"dreev.promises.to/ping_oli/by/nov_16\", // 9-15\n\"dreev.promises.to/ping_byorgey/by/dec_20\", // 9-15\n\"dreev.promises.to/labelzero/by/1am\", // 9-15\n\"chris.promises.to/follow_up_on_that_support_thread\", // 9-18\n\"bee.commits.to/new-family-photo-to-yoko/by/tomorrow-night\", // 9-18, done early\n\"bee.commits.to/rest-of-paperwork-to-yoko-before-the-gym-tomorrow\", // 9-18, 2 hours late\n\"dreev.promises.to/debug_capitalization/by/tomorrow\", // 9-18, done 23.4 hours late\n\"bee.commits.to/email-sleep-as-android-for-specifics-about-sleep-length-measurement\", // 9-19\n\"jessica.commits.to/let_bob_know_re_meeting/by/tomorrow_5pm\", // 9-19\n\"samuel.commits.to/finish_ch_23_problem_set/by/today_6_pm\", // 9-19\n\"dreev.promises.to/intern_disc/by/wed\", // 9-19, done early\n\"kim.promises.to/email_argue_summary/by/fri\", // 9-19\n\"dreev.commits.to/clear_bogus_commit_for_nick/by/5_minutes_from_now\", // 9-19, done early\n\"kim.promises.to/reflect_Respond_anxiety_spiral_Assist/by/sat\", // 9-19\n\"dreev.commits.to/schedule-k_tax_thing/by/5pm\", // 9-19, done\n\"dreev.promises.to/set_up_mom_on_wordfeud/by/tomorrow\", // 9-20, done/void\n\"dreev.promises.to/reply_to_use_case_email/by/midnight\", // 9-20, done early\n\"kim.promises.to/consider_all_weekend_social_options/by/fri/10pm\", // 9-20\n\"kim.promises.to/submit_conclusion_email/by/10/16\", // 9-21\n\"kim.promises.to/complete_type_1_essay/by/10/1\", // 9-21\n\"kim.promises.to/inform_eve_plans/by/2\", // 9-21\n\"kim.promises.to/email_cynthia_charlap_tickets/by/9/22\", // 9-21\n\"kim.promises.to/schedule_attorney_meet/by/10/1\", // 9-21\n\"kim.promises.to/john_PAM_photos_ask/by/10/1\", // 9-21\n\"kim.promises.to/Nike_p5_email/by/10/1\", // 9-21\n\"kim.promises.to/intro_martin_marna/by/10/5\", // 9-21\n\"kim.promises.to/sbonomic_jitsjudgelist_doc/by/10/15\", // 9-21\n\"kim.promises.to/consider_all_weekend_social_options/by/fri/10pm\", // 9-21\n\"dreev.commits.to/dedup_the_iwills/by/nov\", // 9-22\n\"byorgey.promises.to/email_cut_property_summary/by/7pm\", // 9-22\n\"dreev.commits.to/copy_editing_pass_on_tao2/by/tmw_2pm\", // 9-22, done\n\"chris.promises.to/open_a_smoothie_shop/by/December\", // 9-25\n\"pierre.promises.to/water_the_office_plant/by/Friday\", // 9-25\n\"dreev.promises.to/hanna_reply/by/tonight\", // 9-26, done\n\"bee.promises.to/read-hannas-emails\", // 9-26\n\"bee.promises.to/reping-one-with-heart\", // 9-26\n\"bee.promises.to/fill-out-metromile-feedback\", // 9-26\n\"bee.promises.to/schedule-planning-with-cantor/by/friday-night\", // 9-26\n\"dreev.promises.to/ask_jana_about_blood_testers/by/dec_1\", // 9-26\n\"dreev.commits.to/take_copyediting_pass_on_micheles_draft/by/saturday\", // 9/27,\n\"stephen.promises.to/decide_upon_late_october_trip/by/saturday\"];\n\nvar users = [\"alice\", \"bob\", \"carol\", // testing\n\"dreev\", \"sergii\", \"kim\", \"bee\", \"braden\", // initial co-conspirators\n\"byorgey\", \"nick\", \"josh\", \"dehowell\", \"caillu\", \"mbork\", \"roy\", // daily beemail\n\"samuel\", \"cole\", \"jessica\", \"steven\", // weekly beemail\n\"chris\", \"stephen\", // contributors\n\"pierre\"];\n\n// invitees\n/* \nlet test\n//test = chrono.parseDate(\"foo the bar by sep 15th noon\")\ntest = chrono.parseDate(\"Call_the_dentist by 2017-10-15 12pm\")\nconsole.log(`DEBUG: ${test} (unixtime = ${test.getTime()/1000}`)\nconsole.log(\"DEBUG: \", JSON.stringify(parseProm(promises[2])))\n*/\n\nvar Promise;\n\n// set up a new database using database credentials set in .env\nvar sequelize = new Sequelize('database', process.env.DB_USER, process.env.DB_PASS, {\n  host: '0.0.0.0',\n  dialect: 'sqlite',\n  pool: {\n    max: 5,\n    min: 0,\n    idle: 10000\n  },\n  // Security note: db is saved to `.data/database.sqlite` in local filesystem.\n  // Nothing in `.data` directory gets copied if someone remixes the project.\n  storage: '.data/database.sqlite'\n});\n\n// authenticate with the database\nsequelize.authenticate().then(function (err) {\n  console.log('Connection has been established successfully.');\n  // define a new table 'promises'\n  Promise = sequelize.define('promises', {\n    urtx: { type: Sequelize.STRING }, // urtext, including whole URL\n    user: { type: Sequelize.STRING }, // who's making the promise\n    what: { type: Sequelize.STRING }, // what's being promised\n    //whom: { type: Sequelize.STRING  }, // to whom are you promising\n    tini: { type: Sequelize.INTEGER }, // unixtime that promise was made\n    tdue: { type: Sequelize.STRING } // unixtime that the promise is due\n    //tmzn: { type: Sequelize.STRING  }, // timezone\n    //wtdid: { type: Sequelize.INTEGER }, // unixtime that the promise was fulfilled\n    //fill: { type: Sequelize.FLOAT   }, // fraction fulfilled\n    //void: { type: Sequelize.BOOLEAN }, // whether promise was voided\n    // text:   { type: Sequelize.STRING }, // this was just for testing\n  });\n  //setup()\n}).catch(function (err) {\n  console.log('Unable to connect to the database: ', err);\n});\n\n// populate table with hardcoded promises above\nfunction setup() {\n  Promise.sync({ force: true }) // 'force: true' just drops the table if it exists\n  .then(function () {\n    // and creates a new one!\n    // Add the default promises to the database\n    for (var i = 0; i < promises.length; i++) {\n      Promise.create(parseProm(promises[i]));\n    }\n  });\n}\n\napp.get('/promise/:udp/:urtx', function (req, resp) {\n  var urtx = req.originalUrl.substr(9);\n  Promise.findOne({ where: { urtx: urtx } }).then(function (promise) {\n    console.log('single promise', urtx, promise);\n    // resp.write(promise)\n    resp.json(promise);\n  });\n});\n\napp.get('/', function (req, resp) {\n  resp.sendFile(__dirname + '/public/index.html');\n});\n\napp.get('/promises', function (req, resp) {\n  var dbPromises = {};\n  Promise.findAll({\n    order: sequelize.literal('tini DESC')\n  }).then(function (promises) {\n    console.log('a;; promises', promises);\n    promises.forEach(function (promise) {\n      dbPromises[promise.user] = dbPromises[promise.user] || [];\n      dbPromises[promise.user].push(promise); // adds their info to dbPromises value\n    });\n    resp.send(dbPromises); // sends dbPromises back to the page\n  });\n});\n\napp.get('/promises/:user', function (req, resp) {\n  var dbPromises = [];\n  Promise.findAll({\n    where: {\n      user: req.params.user\n    }\n  }).then(function (promises) {\n    console.log('user promises', promises);\n    promises.forEach(function (promise) {\n      dbPromises.push(promise); // adds their info to dbPromises value\n    });\n    resp.send(dbPromises); // sends dbPromises back to the page\n  });\n});\n\napp.get('/promises/remove/:urtx', function (req, resp) {\n  Promise.findAll({\n    where: {\n      user: req.params.user\n    }\n  });\n});\n\n// creates a new entry in the promises table with the submitted values\napp.post('/promises', function (req, resp) {\n  console.log('promise req', req, resp);\n  Promise.create({ text: req.query.promise });\n  resp.sendStatus(200);\n});\n\napp.get('/reset', function (req, resp) {\n  setup();\n  resp.redirect('/');\n});\n\n// removes all entries from the promises table\napp.get('/clear', function (req, resp) {\n  Promise.destroy({ where: {} });\n  resp.redirect('/');\n});\n\n/*\nLittle picture: Why does this error handling code not run when I surf to \na bad URL like iwill.glitch.me/foo%bar\n\nBigger picture: I'm making an app that needs to process any URL the user may \nthrow at it. I need the server to get the exact URL the way the user sees it in \nthe browser. That's going to be especially tricky for things like '#' characters\nbut right now I'm just trying to figure out the case of arbitrary '%' characters\nthat may not correspond to proper %-encodings.\n\nI'm thinking like a catchall error-handling route that no matter what weird\nencoding or whatever error is thrown I can still have the code here do something\nwith the URL as the user typed it.\n\nFor now we're just dropping all this and having the app give the user an error\nif there are any weird characters in the URL.\n\napp.use(function(req, resp, next) {\n  var err = null\n  try {\n    console.log(\"TRYING\", req.path, req.url)\n    decodeURIComponent(req.path)\n  } catch(e) {\n    err = e\n  }\n  if (err) {\n    console.log(\"CAUGHT ERR:\", err, req.url)\n    return resp.redirect('/')\n  }\n  next();\n\n  //console.log(\"DEBUG USE1:\", req.originalUrl)\n  //resp.redirect('/')\n})\n*/\n\napp.all('*', function (req, resp) {\n  // The server at promises.to passes along the full URL the way the user typed\n  // it, so when the user hits \"bob.promises.to/foo\" the Glitch app is called\n  // with \"iwill.glitch.me/bob.promises.to/foo\" and req.originalUrl is\n  // \"/bob.promises.to/foo\" (originalUrl doesn't include the hostname)\n  var urtx = req.originalUrl.substr(1); // get rid of the initial slash\n  // urtx is now, eg, \"bob.promises.to/foo_the_bar/by/9am\"\n\n  // TODO: don't try to parse a promise if no subdomain, ie, no user given\n  // TODOLATER: how to handle \"bob.promises.to/foo%bar\"\n  // TODOLATER: need to url-decode to handle \"bob.promises.to/foo^bar\"\n  // TODOLATER: handle bob.promises.to/do_item_#2/by/9am\n  //           https://stackoverflow.com/questions/18796421/capture-anchor-links\n\n  console.log(\"DEBUG urtx:\", urtx);\n  // Parse the urtext into user, what, whom, tini, tdue, etc\n  // Check if a promise already exists with matching user+'|'+what\n  // If not, create it\n  // If so, do nothing\n  var p = parseProm(urtx);\n  // TODO: if the url was just alice.promises.to then we want to show alice's\n  // statistics and list of promises and everything\n  if (p.user === 'www' || p.user === '') {\n    // TODO: this is the case of no username, like if someone just went to\n    // \"promises.to\" or tried to fetch \"promises.to/robots.txt\" or whatever\n    resp.sendFile(__dirname + '/public/index.html');\n  } else if (!users.includes(p.user)) {\n    // TODO: tell user \"Sorry, no such user! Get in touch if you want to get in\n    // on our beta!\"\n    resp.sendFile(__dirname + '/public/index.html');\n  } else {\n    Promise.findOne({ where: { urtx: urtx } }).then(function (promise) {\n      if (promise) {\n        console.log('duplicate', urtx);\n        resp.redirect('/promise/' + urtx);\n      } else {\n        Promise.create(p);\n        mailself('PROMISE', urtx);\n      }\n    });\n\n    resp.sendFile(__dirname + '/public/index.html');\n  }\n});\n\nvar listener = app.listen(process.env.PORT, function () {\n  console.log('Promises app is listening on port ' + listener.address().port);\n});\n\n// --------------------------------- 80chars ---------------------------------->\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZlci5qcyJdLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsIlNlcXVlbGl6ZSIsImFwcCIsImNocm9ubyIsIk1haWxndW4iLCJtb21lbnQiLCJ1c2UiLCJzdGF0aWMiLCJtYWlsc2VsZiIsInN1YmoiLCJib2R5IiwibWFpbGd1biIsImFwaUtleSIsInByb2Nlc3MiLCJlbnYiLCJNQUlMR1VOX0tFWSIsImRvbWFpbiIsIk1BSUxHVU5fRE9NQUlOIiwiZGF0YSIsImZyb20iLCJNQUlMR1VOX0ZST00iLCJ0byIsIk1ZX0VNQUlMIiwic3ViamVjdCIsInRleHQiLCJtZXNzYWdlcyIsInNlbmQiLCJlcnIiLCJwYXJzZVByb20iLCJ1cnR4IiwibSIsIm1hdGNoIiwidXNlciIsInBhdGgiLCJ3aGF0IiwidGR1ZSIsIkRhdGUiLCJub3ciLCJsZW5ndGgiLCJwYXJzZWRQYXRoIiwiY29uc29sZSIsImxvZyIsInRpbmkiLCJjcmVkaXQiLCJ0IiwicHJvbWlzZXMiLCJ1c2VycyIsIlByb21pc2UiLCJzZXF1ZWxpemUiLCJEQl9VU0VSIiwiREJfUEFTUyIsImhvc3QiLCJkaWFsZWN0IiwicG9vbCIsIm1heCIsIm1pbiIsImlkbGUiLCJzdG9yYWdlIiwiYXV0aGVudGljYXRlIiwidGhlbiIsImRlZmluZSIsInR5cGUiLCJTVFJJTkciLCJJTlRFR0VSIiwiY2F0Y2giLCJzZXR1cCIsInN5bmMiLCJmb3JjZSIsImkiLCJjcmVhdGUiLCJnZXQiLCJyZXEiLCJyZXNwIiwib3JpZ2luYWxVcmwiLCJzdWJzdHIiLCJmaW5kT25lIiwid2hlcmUiLCJwcm9taXNlIiwianNvbiIsInNlbmRGaWxlIiwiX19kaXJuYW1lIiwiZGJQcm9taXNlcyIsImZpbmRBbGwiLCJvcmRlciIsImxpdGVyYWwiLCJmb3JFYWNoIiwicHVzaCIsInBhcmFtcyIsInBvc3QiLCJxdWVyeSIsInNlbmRTdGF0dXMiLCJyZWRpcmVjdCIsImRlc3Ryb3kiLCJhbGwiLCJwIiwiaW5jbHVkZXMiLCJsaXN0ZW5lciIsImxpc3RlbiIsIlBPUlQiLCJhZGRyZXNzIiwicG9ydCJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBLElBQUlBLFVBQVVDLFFBQVEsU0FBUixDQUFkO0FBQ0EsSUFBSUMsWUFBWUQsUUFBUSxXQUFSLENBQWhCO0FBQ0EsSUFBSUUsTUFBTUgsU0FBVjtBQUNBLElBQUlJLFNBQVNILFFBQVEsYUFBUixDQUFiLEMsQ0FBb0M7QUFDcEMsSUFBSUksVUFBVUosUUFBUSxZQUFSLENBQWQ7QUFDQSxJQUFJSyxTQUFTTCxRQUFRLFFBQVIsQ0FBYjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQUUsSUFBSUksR0FBSixDQUFRUCxRQUFRUSxNQUFSLENBQWUsUUFBZixDQUFSOztBQUVBLFNBQVNDLFFBQVQsQ0FBa0JDLElBQWxCLEVBQXdCQyxJQUF4QixFQUE4QjtBQUM1QixNQUFJQyxVQUFVLElBQUlQLE9BQUosQ0FBWSxFQUFDUSxRQUFRQyxRQUFRQyxHQUFSLENBQVlDLFdBQXJCO0FBQ0NDLFlBQVFILFFBQVFDLEdBQVIsQ0FBWUcsY0FEckIsRUFBWixDQUFkO0FBRUEsTUFBSUMsT0FBTztBQUNUQyxVQUFTTixRQUFRQyxHQUFSLENBQVlNLFlBRFo7QUFFVEMsUUFBU1IsUUFBUUMsR0FBUixDQUFZUSxRQUZaO0FBR1RDLGFBQVNkLElBSEE7QUFJVGUsVUFBU2Q7QUFKQSxHQUFYO0FBTUFDLFVBQVFjLFFBQVIsR0FBbUJDLElBQW5CLENBQXdCUixJQUF4QixFQUE4QixVQUFDUyxHQUFELEVBQU1qQixJQUFOLEVBQWUsQ0FBRSxDQUEvQztBQUNEOztBQUVEO0FBQ0EsU0FBU2tCLFNBQVQsQ0FBbUJDLElBQW5CLEVBQXlCO0FBQ3ZCLE1BQUlDLElBQUlELEtBQUtFLEtBQUwsQ0FBVywwQ0FBWCxDQUFSO0FBQ0E7QUFDQSxNQUFJQyxPQUFPRixJQUFJQSxFQUFFLENBQUYsQ0FBSixHQUFXLEVBQXRCO0FBQ0EsTUFBSWQsU0FBU2MsSUFBSUEsRUFBRSxDQUFGLENBQUosR0FBVyxFQUF4QjtBQUNBLE1BQUlHLE9BQU9ILElBQUlBLEVBQUUsQ0FBRixDQUFKLEdBQVcsRUFBdEI7QUFDQSxNQUFJSSxPQUFPLEVBQVg7QUFDQSxNQUFJQyxPQUFPQyxLQUFLQyxHQUFMLEtBQWEsSUFBRSxFQUFGLEdBQUssRUFBTCxHQUFRLEVBQVIsR0FBVyxJQUFuQztBQUNBLE1BQUlKLEtBQUtLLE1BQUwsR0FBYyxDQUFsQixFQUFxQjtBQUNuQixRQUFJQyxhQUFhTixLQUFLRixLQUFMLENBQVcsdUJBQVgsQ0FBakI7QUFDQUcsV0FBT0ssV0FBVyxDQUFYLENBQVAsQ0FGbUIsQ0FFRTtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQUosV0FBT0ksV0FBVyxDQUFYLENBQVA7QUFDRDtBQUNEO0FBQ0E7QUFDQUMsVUFBUUMsR0FBUixDQUFZLFdBQVosRUFBeUIsRUFBRVQsVUFBRixFQUFRQyxVQUFSLEVBQWNqQixjQUFkLEVBQXNCa0IsVUFBdEIsRUFBNEJDLFVBQTVCLEVBQWtDTixVQUFsQyxFQUF6QjtBQUNBLFNBQU8sRUFBRUcsVUFBRixFQUFRQyxVQUFSLEVBQWNqQixjQUFkLEVBQXNCa0IsVUFBdEIsRUFBNEJDLFVBQTVCLEVBQWtDTixVQUFsQyxFQUF3Q2EsTUFBTU4sS0FBS0MsR0FBTCxFQUE5QyxFQUFQO0FBQ0Q7O0FBRUQ7QUFDQSxTQUFTTSxNQUFULENBQWdCQyxDQUFoQixFQUFtQjtBQUNqQjtBQUNBLFNBQU8sQ0FBUDtBQUNEOztBQUVEO0FBQ0EsSUFBSUMsV0FBVyxDQUNiLG1EQURhLEVBRWIsa0RBRmEsRUFHYiw0Q0FIYSxFQUliLGtFQUphLEVBSXVEO0FBQ3BFLHNEQUxhLEVBSzJDO0FBQ3hELGdEQU5hLEVBTXFDO0FBQ2xELGlEQVBhLEVBT3NDO0FBQ25ELHdEQVJhLEVBUTZDO0FBQzFELDBDQVRhLEVBUytCO0FBQzVDLDZDQVZhLEVBVWtDO0FBQy9DLDREQVhhLEVBV2lEO0FBQzlELHVEQVphLEVBWTRDO0FBQ3pELDZEQWJhLEVBYWtEO0FBQy9ELG9DQWRhLEVBY3lCO0FBQ3RDLG1EQWZhLEVBZXdDO0FBQ3JELHNEQWhCYSxFQWdCMkM7QUFDeEQseURBakJhLEVBaUI4QztBQUMzRCxzREFsQmEsRUFrQjJDO0FBQ3hELHlDQW5CYSxFQW1COEI7QUFDM0MscURBcEJhLEVBb0IwQztBQUN2RCxzQ0FyQmEsRUFxQjJCO0FBQ3hDLDBDQXRCYSxFQXNCK0I7QUFDNUMsb0NBdkJhLEVBdUJ5QjtBQUN0QyxvREF4QmEsRUF3QnlDO0FBQ3RELDJEQXpCYSxFQXlCZ0Q7QUFDN0Qsa0VBMUJhLEVBMEJ1RDtBQUNwRSxvREEzQmEsRUEyQnlDO0FBQ3RELG9GQTVCYSxFQTRCeUU7QUFDdEYsNERBN0JhLEVBNkJpRDtBQUM5RCwwREE5QmEsRUE4QitDO0FBQzVELHNDQS9CYSxFQStCMkI7QUFDeEMsNENBaENhLEVBZ0NpQztBQUM5QyxvRUFqQ2EsRUFpQ3lEO0FBQ3RFLDhEQWxDYSxFQWtDbUQ7QUFDaEUsOENBbkNhLEVBbUNtQztBQUNoRCxzREFwQ2EsRUFvQzJDO0FBQ3hELHVEQXJDYSxFQXFDNEM7QUFDekQsaUVBdENhLEVBc0NzRDtBQUNuRSxrREF2Q2EsRUF1Q3VDO0FBQ3BELCtDQXhDYSxFQXdDb0M7QUFDakQsdUNBekNhLEVBeUM0QjtBQUN6Qyx1REExQ2EsRUEwQzRDO0FBQ3pELGdEQTNDYSxFQTJDcUM7QUFDbEQsNkNBNUNhLEVBNENrQztBQUMvQyx1Q0E3Q2EsRUE2QzRCO0FBQ3pDLDRDQTlDYSxFQThDaUM7QUFDOUMscURBL0NhLEVBK0MwQztBQUN2RCxpRUFoRGEsRUFnRHNEO0FBQ25FLDBDQWpEYSxFQWlEK0I7QUFDNUMsdURBbERhLEVBa0Q0QztBQUN6RCx1REFuRGEsRUFtRDRDO0FBQ3pELG9EQXBEYSxFQW9EeUM7QUFDdEQscURBckRhLEVBcUQwQztBQUN2RCwwQ0F0RGEsRUFzRCtCO0FBQzVDLG9DQXZEYSxFQXVEeUI7QUFDdEMsdUNBeERhLEVBd0Q0QjtBQUN6Qyw2Q0F6RGEsRUF5RGtDO0FBQy9DLCtEQTFEYSxFQTBEb0Q7QUFDakUseURBM0RhLEVBMkQ4QztBQUMzRCxzRUE1RGEsRUE0RDJEO0FBQ3hFLCtEQTdEYSxDQUFmOztBQWdFQSxJQUFJQyxRQUFRLENBQ1YsT0FEVSxFQUNELEtBREMsRUFDTSxPQUROLEVBQ2U7QUFDekIsT0FGVSxFQUVELFFBRkMsRUFFUyxLQUZULEVBRWdCLEtBRmhCLEVBRXVCLFFBRnZCLEVBRWlDO0FBQzNDLFNBSFUsRUFHQyxNQUhELEVBR1MsTUFIVCxFQUdpQixVQUhqQixFQUc2QixRQUg3QixFQUd1QyxPQUh2QyxFQUdnRCxLQUhoRCxFQUd1RDtBQUNqRSxRQUpVLEVBSUEsTUFKQSxFQUlRLFNBSlIsRUFJbUIsUUFKbkIsRUFJNkI7QUFDdkMsT0FMVSxFQUtELFNBTEMsRUFLVTtBQUNwQixRQU5VLENBQVo7O0FBTVk7QUFHWjs7Ozs7Ozs7QUFRQSxJQUFJQyxPQUFKOztBQUVBO0FBQ0EsSUFBSUMsWUFBWSxJQUFJL0MsU0FBSixDQUFjLFVBQWQsRUFBMEJZLFFBQVFDLEdBQVIsQ0FBWW1DLE9BQXRDLEVBQzBCcEMsUUFBUUMsR0FBUixDQUFZb0MsT0FEdEMsRUFDK0M7QUFDN0RDLFFBQU0sU0FEdUQ7QUFFN0RDLFdBQVMsUUFGb0Q7QUFHN0RDLFFBQU07QUFDSkMsU0FBSyxDQUREO0FBRUpDLFNBQUssQ0FGRDtBQUdKQyxVQUFNO0FBSEYsR0FIdUQ7QUFRN0Q7QUFDQTtBQUNBQyxXQUFTO0FBVm9ELENBRC9DLENBQWhCOztBQWNBO0FBQ0FULFVBQVVVLFlBQVYsR0FDR0MsSUFESCxDQUNRLFVBQVNoQyxHQUFULEVBQWM7QUFDbEJhLFVBQVFDLEdBQVIsQ0FBWSwrQ0FBWjtBQUNBO0FBQ0FNLFlBQVVDLFVBQVVZLE1BQVYsQ0FBaUIsVUFBakIsRUFBNkI7QUFDckMvQixVQUFNLEVBQUVnQyxNQUFNNUQsVUFBVTZELE1BQWxCLEVBRCtCLEVBQ0Y7QUFDbkM5QixVQUFNLEVBQUU2QixNQUFNNUQsVUFBVTZELE1BQWxCLEVBRitCLEVBRUY7QUFDbkM1QixVQUFNLEVBQUUyQixNQUFNNUQsVUFBVTZELE1BQWxCLEVBSCtCLEVBR0Y7QUFDbkM7QUFDQXBCLFVBQU0sRUFBRW1CLE1BQU01RCxVQUFVOEQsT0FBbEIsRUFMK0IsRUFLRjtBQUNuQzVCLFVBQU0sRUFBRTBCLE1BQU01RCxVQUFVNkQsTUFBbEIsRUFOK0IsQ0FNSDtBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBWHFDLEdBQTdCLENBQVY7QUFhQTtBQUNELENBbEJILEVBbUJHRSxLQW5CSCxDQW1CUyxVQUFVckMsR0FBVixFQUFlO0FBQ3BCYSxVQUFRQyxHQUFSLENBQVkscUNBQVosRUFBbURkLEdBQW5EO0FBQ0QsQ0FyQkg7O0FBdUJBO0FBQ0EsU0FBU3NDLEtBQVQsR0FBaUI7QUFDZmxCLFVBQVFtQixJQUFSLENBQWEsRUFBQ0MsT0FBTyxJQUFSLEVBQWIsRUFBNEI7QUFBNUIsR0FDR1IsSUFESCxDQUNRLFlBQVU7QUFBVTtBQUN4QjtBQUNBLFNBQUssSUFBSVMsSUFBSSxDQUFiLEVBQWdCQSxJQUFJdkIsU0FBU1AsTUFBN0IsRUFBcUM4QixHQUFyQyxFQUEwQztBQUN4Q3JCLGNBQVFzQixNQUFSLENBQWV6QyxVQUFVaUIsU0FBU3VCLENBQVQsQ0FBVixDQUFmO0FBQ0Q7QUFDRixHQU5IO0FBT0Q7O0FBRURsRSxJQUFJb0UsR0FBSixDQUFRLHFCQUFSLEVBQStCLFVBQVNDLEdBQVQsRUFBY0MsSUFBZCxFQUFvQjtBQUNqRCxNQUFJM0MsT0FBTzBDLElBQUlFLFdBQUosQ0FBZ0JDLE1BQWhCLENBQXVCLENBQXZCLENBQVg7QUFDQTNCLFVBQVE0QixPQUFSLENBQWdCLEVBQUVDLE9BQU8sRUFBQy9DLFVBQUQsRUFBVCxFQUFoQixFQUNHOEIsSUFESCxDQUNRLFVBQVNrQixPQUFULEVBQWtCO0FBQ3RCckMsWUFBUUMsR0FBUixDQUFZLGdCQUFaLEVBQThCWixJQUE5QixFQUFvQ2dELE9BQXBDO0FBQ0Y7QUFDQUwsU0FBS00sSUFBTCxDQUFVRCxPQUFWO0FBQ0QsR0FMRDtBQU9ELENBVEQ7O0FBV0EzRSxJQUFJb0UsR0FBSixDQUFRLEdBQVIsRUFBYSxVQUFDQyxHQUFELEVBQU1DLElBQU4sRUFBZTtBQUMxQkEsT0FBS08sUUFBTCxDQUFjQyxZQUFZLG9CQUExQjtBQUNELENBRkQ7O0FBSUE5RSxJQUFJb0UsR0FBSixDQUFRLFdBQVIsRUFBcUIsVUFBU0MsR0FBVCxFQUFjQyxJQUFkLEVBQW9CO0FBQ3ZDLE1BQUlTLGFBQWEsRUFBakI7QUFDQWxDLFVBQVFtQyxPQUFSLENBQWdCO0FBQ2RDLFdBQU9uQyxVQUFVb0MsT0FBVixDQUFrQixXQUFsQjtBQURPLEdBQWhCLEVBRUd6QixJQUZILENBRVEsVUFBU2QsUUFBVCxFQUFtQjtBQUN6QkwsWUFBUUMsR0FBUixDQUFZLGNBQVosRUFBNEJJLFFBQTVCO0FBQ0FBLGFBQVN3QyxPQUFULENBQWlCLFVBQVNSLE9BQVQsRUFBa0I7QUFDakNJLGlCQUFXSixRQUFRN0MsSUFBbkIsSUFBMkJpRCxXQUFXSixRQUFRN0MsSUFBbkIsS0FBNEIsRUFBdkQ7QUFDQWlELGlCQUFXSixRQUFRN0MsSUFBbkIsRUFBeUJzRCxJQUF6QixDQUE4QlQsT0FBOUIsRUFGaUMsQ0FFTTtBQUN4QyxLQUhEO0FBSUFMLFNBQUs5QyxJQUFMLENBQVV1RCxVQUFWLEVBTnlCLENBTUg7QUFDdkIsR0FURDtBQVVELENBWkQ7O0FBY0EvRSxJQUFJb0UsR0FBSixDQUFRLGlCQUFSLEVBQTJCLFVBQVNDLEdBQVQsRUFBY0MsSUFBZCxFQUFvQjtBQUM3QyxNQUFJUyxhQUFhLEVBQWpCO0FBQ0FsQyxVQUFRbUMsT0FBUixDQUFnQjtBQUNmTixXQUFPO0FBQ0w1QyxZQUFNdUMsSUFBSWdCLE1BQUosQ0FBV3ZEO0FBRFo7QUFEUSxHQUFoQixFQUlHMkIsSUFKSCxDQUlRLFVBQVNkLFFBQVQsRUFBbUI7QUFDekJMLFlBQVFDLEdBQVIsQ0FBWSxlQUFaLEVBQTZCSSxRQUE3QjtBQUNBQSxhQUFTd0MsT0FBVCxDQUFpQixVQUFTUixPQUFULEVBQWtCO0FBQ2pDSSxpQkFBV0ssSUFBWCxDQUFnQlQsT0FBaEIsRUFEaUMsQ0FDUjtBQUMxQixLQUZEO0FBR0FMLFNBQUs5QyxJQUFMLENBQVV1RCxVQUFWLEVBTHlCLENBS0g7QUFDdkIsR0FWRDtBQVdELENBYkQ7O0FBZUEvRSxJQUFJb0UsR0FBSixDQUFRLHdCQUFSLEVBQWtDLFVBQUNDLEdBQUQsRUFBTUMsSUFBTixFQUFlO0FBQy9DekIsVUFBUW1DLE9BQVIsQ0FBZ0I7QUFDZk4sV0FBTztBQUNMNUMsWUFBTXVDLElBQUlnQixNQUFKLENBQVd2RDtBQURaO0FBRFEsR0FBaEI7QUFLRCxDQU5EOztBQVFBO0FBQ0E5QixJQUFJc0YsSUFBSixDQUFTLFdBQVQsRUFBc0IsVUFBQ2pCLEdBQUQsRUFBTUMsSUFBTixFQUFlO0FBQ25DaEMsVUFBUUMsR0FBUixDQUFZLGFBQVosRUFBMkI4QixHQUEzQixFQUFnQ0MsSUFBaEM7QUFDQXpCLFVBQVFzQixNQUFSLENBQWUsRUFBRTdDLE1BQU0rQyxJQUFJa0IsS0FBSixDQUFVWixPQUFsQixFQUFmO0FBQ0FMLE9BQUtrQixVQUFMLENBQWdCLEdBQWhCO0FBQ0QsQ0FKRDs7QUFNQXhGLElBQUlvRSxHQUFKLENBQVEsUUFBUixFQUFrQixVQUFDQyxHQUFELEVBQU1DLElBQU4sRUFBZTtBQUMvQlA7QUFDQU8sT0FBS21CLFFBQUwsQ0FBYyxHQUFkO0FBQ0QsQ0FIRDs7QUFLQTtBQUNBekYsSUFBSW9FLEdBQUosQ0FBUSxRQUFSLEVBQWtCLFVBQUNDLEdBQUQsRUFBTUMsSUFBTixFQUFlO0FBQy9CekIsVUFBUTZDLE9BQVIsQ0FBZ0IsRUFBQ2hCLE9BQU8sRUFBUixFQUFoQjtBQUNBSixPQUFLbUIsUUFBTCxDQUFjLEdBQWQ7QUFDRCxDQUhEOztBQUtBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFvQ0F6RixJQUFJMkYsR0FBSixDQUFRLEdBQVIsRUFBYSxVQUFDdEIsR0FBRCxFQUFNQyxJQUFOLEVBQWU7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFJM0MsT0FBTzBDLElBQUlFLFdBQUosQ0FBZ0JDLE1BQWhCLENBQXVCLENBQXZCLENBQVgsQ0FMMEIsQ0FLVztBQUNyQzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBbEMsVUFBUUMsR0FBUixDQUFZLGFBQVosRUFBMkJaLElBQTNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFJaUUsSUFBSWxFLFVBQVVDLElBQVYsQ0FBUjtBQUNBO0FBQ0E7QUFDQSxNQUFJaUUsRUFBRTlELElBQUYsS0FBVyxLQUFYLElBQW9COEQsRUFBRTlELElBQUYsS0FBVyxFQUFuQyxFQUF1QztBQUNyQztBQUNBO0FBQ0F3QyxTQUFLTyxRQUFMLENBQWNDLFlBQVksb0JBQTFCO0FBQ0QsR0FKRCxNQUlPLElBQUksQ0FBQ2xDLE1BQU1pRCxRQUFOLENBQWVELEVBQUU5RCxJQUFqQixDQUFMLEVBQTZCO0FBQ2xDO0FBQ0E7QUFDQXdDLFNBQUtPLFFBQUwsQ0FBY0MsWUFBWSxvQkFBMUI7QUFDRCxHQUpNLE1BSUE7QUFDTGpDLFlBQVE0QixPQUFSLENBQWdCLEVBQUVDLE9BQU8sRUFBQy9DLFVBQUQsRUFBVCxFQUFoQixFQUNHOEIsSUFESCxDQUNRLG1CQUFXO0FBQ2YsVUFBSWtCLE9BQUosRUFBYTtBQUNYckMsZ0JBQVFDLEdBQVIsQ0FBWSxXQUFaLEVBQXlCWixJQUF6QjtBQUNBMkMsYUFBS21CLFFBQUwsZUFBMEI5RCxJQUExQjtBQUNELE9BSEQsTUFHTztBQUNMa0IsZ0JBQVFzQixNQUFSLENBQWV5QixDQUFmO0FBQ0F0RixpQkFBUyxTQUFULEVBQW9CcUIsSUFBcEI7QUFDRDtBQUNKLEtBVEQ7O0FBV0EyQyxTQUFLTyxRQUFMLENBQWNDLFlBQVksb0JBQTFCO0FBQ0Q7QUFDRixDQTVDRDs7QUE4Q0EsSUFBSWdCLFdBQVc5RixJQUFJK0YsTUFBSixDQUFXcEYsUUFBUUMsR0FBUixDQUFZb0YsSUFBdkIsRUFBNkIsWUFBVztBQUNyRDFELFVBQVFDLEdBQVIsQ0FBWSx1Q0FBdUN1RCxTQUFTRyxPQUFULEdBQW1CQyxJQUF0RTtBQUNELENBRmMsQ0FBZjs7QUFJQSIsImZpbGUiOiJzZXJ2ZXIuanMiLCJzb3VyY2VSb290IjoiL2FwcCIsInNvdXJjZXNDb250ZW50IjpbIi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSA4MGNoYXJzIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0+XG52YXIgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKVxudmFyIFNlcXVlbGl6ZSA9IHJlcXVpcmUoJ3NlcXVlbGl6ZScpXG52YXIgYXBwID0gZXhwcmVzcygpXG52YXIgY2hyb25vID0gcmVxdWlyZSgnY2hyb25vLW5vZGUnKSAvLyBTdWdhci5qcyBwYXJzZXMgc29tZSB0aGluZ3MgYmV0dGVyXG52YXIgTWFpbGd1biA9IHJlcXVpcmUoJ21haWxndW4tanMnKVxudmFyIG1vbWVudCA9IHJlcXVpcmUoJ21vbWVudCcpXG5cbi8vIERBVEFCQVNFIEZJRUxEUzpcbi8vICAgdXJ0eCAtLSB1cnRleHQsIGllLCBmdWxsIG9yaWdpbmFsIHRleHQgdGhlIHVzZXIgdHlwZWQgdG8gY3JlYXRlIHRoZSBwcm9taXNlXG4vLyAgIHVzZXIgLS0gd2hvJ3MgbWFraW5nIHRoZSBwcm9taXNlXG4vLyAgIHdoYXQgLS0gd2hhdCdzIGJlaW5nIHByb21pc2VkXG4vLyAgIHdob20gLS0gdG8gd2hvbSBhcmUgeW91IHByb21pc2luZ1xuLy8gICB0aW5pIC0tIHVuaXh0aW1lIHRoYXQgdGhlIHByb21pc2Ugd2FzIG1hZGVcbi8vICAgdGR1ZSAtLSB1bml4dGltZSB0aGF0IHRoZSBwcm9taXNlIGlzIGR1ZVxuLy8gICB0bXpuIC0tIHRpbWV6b25lIGFzc3VtZWQgZm9yIHBhcnNpbmcgdGhlIGRlYWRsaW5lXG4vLyAgIHRmaW4gLS0gdW5peHRpbWUgdGhhdCB0aGUgcHJvbWlzZSB3YXMgZnVsZmlsbGVkXG4vLyAgIGZpbGwgLS0gZnJhY3Rpb24gZnVsZmlsbGVkLCBkZWZhdWx0IDBcbi8vICAgdm9pZCAtLSB0cnVlIGlmIHRoZSBwcm9taXNlIGJlY2FtZSB1bmZ1bGZpbGxhYmxlIG9yIG1vb3Rcbi8vICAgY2xpeCAtLSBudW1iZXIgb2YgY2xpY2tzIGEgcHJvbWlzZSBoYXMgZ290dGVuXG4vLyBGb3IgZXhhbXBsZTpcbi8vICAgdXJ0eCA9IFwiYm9iLnByb21pc2VzLnRvL2Zvb190aGVfYmFyL2J5L25vb25fdG9tb3Jyb3dcIlxuLy8gICB1c2VyID0gXCJib2JcIlxuLy8gICB3aGF0ID0gXCJmb28gdGhlIGJhclwiXG4vLyAgIHdob20gPSBudWxsXG4vLyAgIHRpbmkgPSBbdW5peHRpbWUgb2YgZmlyc3QgR0VUIHJlcXVlc3Qgb2YgdGhlIHByb21pc2UncyBVUkxdXG4vLyAgIHRkdWUgPSBbd2hhdCBcIm5vb24gdG9tb3Jyb3dcIiBwYXJzZWQgdG8gYXQgdGltZSB0aW5pXVxuLy8gICB0bXpuID0gXCJBbWVyaWNhL0xvc19BbmdlbGVzXCJcbi8vICAgdGZpbiA9IFt1bml4dGltZSB0aGF0IHRoZSBwcm9taXNlIHdhcyBmdWxmaWxsZWRdXG4vLyAgIGZpbGwgPSAwXG4vLyAgIHZvaWQgPSBmYWxzZVxuXG4vLyBPdGhlciBpZGVhcyBmb3IgZmllbGRzOiBcbi8vICogaW5mb3JtYXRpb24gYWJvdXQgdGhlIGNsaWVudCB0aGF0IG9yaWdpbmFsbHkgY3JlYXRlZCB0aGUgcHJvbWlzZVxuLy8gKiB3aGV0aGVyIHRoZSBwcm9taXNlIHdhcyBjcmVhdGVkIGJ5IHRoZSBhY3R1YWwgdXNlciAoaWYgdGhleSB3ZXJlIGxvZ2dlZCBpbiBcbi8vICAgYW5kIHdlcmUgdGhlIGZpcnN0IHRvIGNsaWNrIG9uIGl0KSBvciBieSBhbm90aGVyIGxvZ2dlZC1pbiB1c2VyIG9yIGJ5IFxuLy8gICBzb21lb25lIG5vdCBsb2dnZWQgaW5cbi8vICogY29uZjogbWF5YmUgd2UgY3JlYXRlIHRoZSBwcm9taXNlIHdoZXRoZXIgb3Igbm90IGFueW9uZSBjbGlja3MgdGhlIGJ1dHRvbiB0byBjb25maXJtXG4vLyAgIGl0LCBpbiB3aGljaCBjYXNlIHdlIHN0b3JlIHdoZW4gaXQncyBhY3R1YWxseSBiZWVuIGNvbmZpcm1lZC5cblxuLy8gTEFURVNUIFNQRUM6XG4vLyBUaGUgXCIvYnkvLi4uXCIgcGFydCBpcyBhbiBvcHRpb25hbCBwb3dlci11c2VyIHRoaW5nLCBub3QgcGFydCBvZiB0aGUgTVZQLlxuLy8gSW5zdGVhZCwgdGhlIGZpcnN0IHRpbWUgeW91IGdvIHRvIGFsaWNlLnByb21pc2VzLnRvL2ZvbyBpdCBnaXZlcyB5b3UgdGhlIFxuLy8gb3B0aW9uIHRvIGNob29zZSBhIGRlYWRsaW5lLCBkZWZhdWx0aW5nIHRvIG5vdys3ZGF5cyAob3IgdG8gd2hhdCB0aGUgXCIvYnkvXCIgXG4vLyBwYXJ0IHBhcnNlZCB0bywgaWYgdGhhdCdzIGVhc3ksIGJ1dCBqdXN0IG1ha2UgaXQgYSBzdWdnZXN0aW9uIGZvciB0aGUgdXNlciwgXG4vLyBqdXN0IGxpa2Ugbm93KzdkYXlzIGlzIGlmIHRoZXkgZG9uJ3Qgc3BlY2lmeSBhIFwiL2J5L1wiKS4gXG4vLyBGb3IgZXZlcnkgc3Vic2VxdWVudCBHRVQgb2YgYWxpY2UucHJvbWlzZXMudG8vZm9vIGl0IHNob3dzIHRoZSBkZWFkbGluZSwgd2l0aFxuLy8gbm8gd2F5IHRvIGNoYW5nZSBpdC5cblxuLy8gSURFQVMgRk9SIExBVEVSOlxuLy8gU2ltcGxlciBkYXRlIHBhcnNpbmc6XG4vLyAgIE1heWJlIHRoZSBkYXRlIGhhcyB0byBiZSBZWVlZLU1NLUREX0hIOk1NXG4vLyAgIEV4YW1wbGU6IGJvYi5wcm9taXNlcy50by9mb29fdGhlX2Jhci9ieS8yMDE3LTA5LTEzXzEyOjAwXG4vLyBNYWdpYyBzcGFjZXM6XG4vLyAgIFdoaWNoZXZlciBub24tYWxwaGFudW1lcmljIGNoYXJhY3RlciBpcyBtb3N0IGNvbW1vbiBpbiB0aGUgdXJ0ZXh0LCB0aGF0J3MgXG4vLyAgIHdoYXQncyBhc3N1bWVkIHRvIGJlIGEgc3BhY2UgYW5kIGlzIHJlcGxhY2VkIHdpdGggc3BhY2VzIGJlZm9yZSBwYXJzaW5nLlxuLy8gTGVzcyBtYWdpY2FsIHZlcnNpb246XG4vLyAgIEEgbm9uLWFscGhhbnVtZXJpYyBjaGFyYWN0ZXIgbXVzdCBmb2xsb3cgXCJhbGljZS5wcm9taXNlcy50by9cIiBhbmQgdGhhdFxuLy8gICBjaGFyYWN0ZXIgaXMgdGFrZW4gYXMgdGhlIGVyc2F0eiBzcGFjZS4gRWc6XG4vLyAgIGFsaWNlLnByb21pc2VzLnRvL19zdGFydF9oZXJfcHJvbWlzZXNfd2l0aF91bmRlcnNjb3Jlc1xuLy8gRmxleGliaWxpdHkgb24gdGhlICcvYnkvJyBwYXJ0OlxuLy8gICBSZXF1aXJpbmcgdGhlIHN0cmluZyAnL2J5LycgdG8gYXBwZWFyIGluIHRoZSBwcm9taXNlIFVSTCBtZWFucyBubyBhbWJpZ3VpdHlcbi8vICAgYWJvdXQgd2hlcmUgdG8gc3RhcnQgcGFyc2luZyB0aGUgZGVhZGxpbmUuIEJ1dCB0aGUgQ2hyb25vIHBhcnNpbmcgbGlicmFyeSBcbi8vICAgYWN0dWFsbHkgZG9lcyBncmVhdCB0YWtpbmcgdGhlIHdob2xlIHN0cmluZyBsaWtlIFwiZm9vIHRoZSBiYXIgYnkgbm9vbiBcbi8vICAgdG9tb3Jyb3dcIiBhbmQgZmlndXJpbmcgb3V0IHRoZSB0aW1lLiBXZSBjb3VsZCBhbHNvIGp1c3QgdGFrZSB0aGUgbGFzdFxuLy8gICBvY2N1cnJlbmNlIG9mIFwiYnlcIiBhbmQgcGFyc2UgZXZlcnl0aGluZyBhZnRlciBpdCBhcyB0aGUgZGVhZGxpbmUuXG5cbmFwcC51c2UoZXhwcmVzcy5zdGF0aWMoJ3B1YmxpYycpKVxuXG5mdW5jdGlvbiBtYWlsc2VsZihzdWJqLCBib2R5KSB7XG4gIHZhciBtYWlsZ3VuID0gbmV3IE1haWxndW4oe2FwaUtleTogcHJvY2Vzcy5lbnYuTUFJTEdVTl9LRVksIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb21haW46IHByb2Nlc3MuZW52Lk1BSUxHVU5fRE9NQUlOfSlcbiAgdmFyIGRhdGEgPSB7XG4gICAgZnJvbTogICAgcHJvY2Vzcy5lbnYuTUFJTEdVTl9GUk9NLFxuICAgIHRvOiAgICAgIHByb2Nlc3MuZW52Lk1ZX0VNQUlMLFxuICAgIHN1YmplY3Q6IHN1YmosXG4gICAgdGV4dDogICAgYm9keSxcbiAgfVxuICBtYWlsZ3VuLm1lc3NhZ2VzKCkuc2VuZChkYXRhLCAoZXJyLCBib2R5KSA9PiB7fSlcbn1cblxuLy8gVGFrZSB1cnRleHQgYW5kIHJldHVybiBhIHByb21pc2UgZGF0YSBzdHJ1Y3R1cmVcbmZ1bmN0aW9uIHBhcnNlUHJvbSh1cnR4KSB7XG4gIGxldCBtID0gdXJ0eC5tYXRjaCgvXihbXlxcLl0rKVxcLihwcm9taXNlc3xjb21taXRzKVxcLnRvXFwvKC4qKSQvKVxuICAvLyBUT0RPOiBoYW5kbGUgdGhlIGNhc2UgdGhhdCBubyB1c2VyIGlzIGdpdmVuLCBqdXN0IFwicHJvbWlzZXMudG8vZm9vXCJcbiAgbGV0IHVzZXIgPSBtID8gbVsxXSA6ICcnXG4gIGxldCBkb21haW4gPSBtID8gbVsyXSA6ICcnXG4gIGxldCBwYXRoID0gbSA/IG1bM10gOiAnJ1xuICBsZXQgd2hhdCA9ICcnXG4gIGxldCB0ZHVlID0gRGF0ZS5ub3coKSArIDcqMjQqNjAqNjAqMTAwMFxuICBpZiAocGF0aC5sZW5ndGggPiAwKSB7XG4gICAgbGV0IHBhcnNlZFBhdGggPSBwYXRoLm1hdGNoKC9eKC4qPykoXFwvYnlcXC98JCkoLiopJC8pXG4gICAgd2hhdCA9IHBhcnNlZFBhdGhbMV0gLy8ucmVwbGFjZSgvXy9nLCAnICcpXG4gICAgLy90ZHVlID0gcGFyc2VkUGF0aC5sZW5ndGggPiAxID8gXG4gICAgLy8gICAgICAgY2hyb25vLnBhcnNlRGF0ZShwYXJzZWRQYXRoWzNdLnJlcGxhY2UoL18vZywgJyAnKSkgKiAxIDogXG4gICAgLy8gICAgICAgRGF0ZS5ub3coKSArIDcqMjQqNjAqNjAqMTAwMFxuICAgIC8vdGR1ZSA9IHRkdWUgPyAoICggdGR1ZSA8IERhdGUubm93KCkgJiYgRGF0ZS5ub3coKSAtIHRkdWUgPCAyNCo2MCo2MCoxMDAwICkgP1xuICAgIC8vICAgICAgICAgICAgICAgIHRkdWUgKyAyNCo2MCo2MCoxMDAwIDogdGR1ZSApXG4gICAgLy8gICAgICAgICAgICA6IERhdGUubm93KCkgKyA3KjI0KjYwKjYwKjEwMDBcbiAgICB0ZHVlID0gcGFyc2VkUGF0aFszXVxuICB9XG4gIC8vIFRPRE86IHBhdGggaXMgbm93IGV2ZXJ5dGhpbmcgYWZ0ZXIgXCIucHJvbWlzZXMudG9cIiBzbyBub3cgcGFyc2Ugb3V0IHRoZSBcbiAgLy8gICAgICAgXCJ3aGF0XCIgKHRoaW5nIGJlaW5nIHByb21pc2VkKSBhbmQgdGhlIFwidGR1ZVwiIChkZWFkbGluZSlcbiAgY29uc29sZS5sb2coJ3BhcnNlUHJvbScsIHsgdXNlciwgcGF0aCwgZG9tYWluLCB3aGF0LCB0ZHVlLCB1cnR4IH0pXG4gIHJldHVybiB7IHVzZXIsIHBhdGgsIGRvbWFpbiwgd2hhdCwgdGR1ZSwgdXJ0eCwgdGluaTogRGF0ZS5ub3coKSB9XG59XG5cbi8vIENvbXB1dGUgdGhlIGNyZWRpdCB5b3UgZ2V0IGZvciBiZWluZyB0IHNlY29uZHMgbGF0ZVxuZnVuY3Rpb24gY3JlZGl0KHQpIHtcbiAgLy8gc2VlIGxhdGVwZW5hbHR5LmpzXG4gIHJldHVybiAxXG59XG5cbi8vIEluaXRpYWwgcHJvbWlzZSBsaXN0IGhhcmRjb2RlZCBzbyBkb24ndCBoYXZlIHRvIHdvcnJ5IGFib3V0IGJsb3dpbmcgZGIgYXdheVxubGV0IHByb21pc2VzID0gW1xuICBcImFsaWNlLnByb21pc2VzLnRvL0ZpbGVfdGhlX1RQU19yZXBvcnQvYnkvbm9vbl9tb25cIixcbiAgXCJib2IucHJvbWlzZXMudG8vU2VuZF92YWNhdGlvbl9waG90b3MvYnkvc2F0dXJkYXlcIixcbiAgXCJjYXJvbC5wcm9taXNlcy50by9DYWxsX3RoZV9kZW50aXN0L2J5LzEyYW1cIixcbiAgXCJkcmVldi5wcm9taXNlcy50by9zaG93X3NlcmdpaV90aGlzX2RvaW5nX3NvbWV0aGluZ191c2VmdWwvYnkvM2FtXCIsIC8vIDktMTAsIGRvbmVcbiAgXCJkcmVldi5wcm9taXNlcy50by9zaG93X2JlZV9vcGVuX3F1ZXN0aW9ucy9ieS8xMDozMHBtXCIsIC8vIDktMTAsIGRvbmVcbiAgXCJicmFkZW4ucHJvbWlzZXMudG8vaGVscF93aXRoX2phdmFzY3JpcHQvYnkvNXBtXCIsIC8vIDktMTFcbiAgXCJkcmVldi5wcm9taXNlcy50by9zaG93X2JyZW5uYW5faW50cm8vYnkvMTA6NTBwbVwiLCAvLyA5LTExLCBkb25lXG4gIFwiZHJlZXYucHJvbWlzZXMudG8vcXVldWVfdHdlZXRfZXRjX2Zvcl9ibG9nX3Bvc3QvYnkvMnBtXCIsIC8vIDktMTEsIGRvbmVcbiAgXCJkcmVldi5wcm9taXNlcy50by9vcmRlcl9pbmRpYW4vYnkvNTozMHBtXCIsIC8vIDktMTIsIGRvbmVcbiAgXCJkcmVldi5jb21taXRzLnRvL2Fza19iZWVfcmVfc3VuZGF5X3Bhcmt3YXlzXCIsIC8vIDktMTMsIGRvbmVcbiAgXCJkcmVldi5jb21taXRzLnRvL2ZvbGxvd191cF93aXRoX2V2ZXJ5b25lX3JlX2d1ZXN0X2Jsb2dnaW5nXCIsIC8vIDktMTNcbiAgXCJqb3NoLmNvbW1pdHMudG8vZ2V0X3JlYWxpc2llc19ydW5uaW5nL2J5L3NlcHRlbWJlcl8zMFwiLCAvLyA5LTEzXG4gIFwiYnJhZGVuLmNvbW1pdHMudG8vb3V0bGluZV9iaXRlX2NvdW50aW5nX3Bvc3QvYnkvU3VuZGF5XzExcG1cIiwgLy8gOS0xM1xuICBcImRyZWV2LmNvbW1pdHMudG8vcmVwb3J0X2dsaXRjaF9idWdcIiwgLy8gOS0xNFxuICBcImRyZWV2LmNvbW1pdHMudG8vZ29vZ2xlZG9jaWZ5X2ludGVybl9mb3JtL2J5LzEycG1cIiwgLy8gOS0xNFxuICBcImRyZWV2LnByb21pc2VzLnRvL3Rlc3RfcGVuYWx0eV9mdW5jL2J5L3NhdHVyZGF5X25vb25cIiwgLy8gOS0xNFxuICBcInNlcmdpaS5wcm9taXNlcy50by93b3JrX29uX3BvaW50c18yX3RvXzQvYnkvbmV4dF9tb25kYXlcIiwgLy8gOS0xNFxuICBcImRyZWV2LmNvbW1pdHMudG8vbWV0YV9kZWJyaWVmX2tpbS9ieS9taWRuaWdodF9mcmlkYXlcIiwgLy8gOS0xNFxuICBcImRyZWV2LmNvbW1pdHMudG8vcGluZ19taXJhYmFpL2J5L3NlcF8yMlwiLCAvLyA5LTE0XG4gIFwiZHJlZXYuY29tbWl0cy50by9zZW5kX21zX2dyb3NzX2VtYWlsL2J5L3N1bmRheV8xMWFtXCIsIC8vIDktMTRcbiAgXCJkcmVldi5wcm9taXNlcy50by9waW5nX29saS9ieS9ub3ZfMTZcIiwgLy8gOS0xNVxuICBcImRyZWV2LnByb21pc2VzLnRvL3BpbmdfYnlvcmdleS9ieS9kZWNfMjBcIiwgLy8gOS0xNVxuICBcImRyZWV2LnByb21pc2VzLnRvL2xhYmVsemVyby9ieS8xYW1cIiwgLy8gOS0xNVxuICBcImNocmlzLnByb21pc2VzLnRvL2ZvbGxvd191cF9vbl90aGF0X3N1cHBvcnRfdGhyZWFkXCIsIC8vIDktMThcbiAgXCJiZWUuY29tbWl0cy50by9uZXctZmFtaWx5LXBob3RvLXRvLXlva28vYnkvdG9tb3Jyb3ctbmlnaHRcIiwgLy8gOS0xOCwgZG9uZSBlYXJseVxuICBcImJlZS5jb21taXRzLnRvL3Jlc3Qtb2YtcGFwZXJ3b3JrLXRvLXlva28tYmVmb3JlLXRoZS1neW0tdG9tb3Jyb3dcIiwgLy8gOS0xOCwgMiBob3VycyBsYXRlXG4gIFwiZHJlZXYucHJvbWlzZXMudG8vZGVidWdfY2FwaXRhbGl6YXRpb24vYnkvdG9tb3Jyb3dcIiwgLy8gOS0xOCwgZG9uZSAyMy40IGhvdXJzIGxhdGVcbiAgXCJiZWUuY29tbWl0cy50by9lbWFpbC1zbGVlcC1hcy1hbmRyb2lkLWZvci1zcGVjaWZpY3MtYWJvdXQtc2xlZXAtbGVuZ3RoLW1lYXN1cmVtZW50XCIsIC8vIDktMTlcbiAgXCJqZXNzaWNhLmNvbW1pdHMudG8vbGV0X2JvYl9rbm93X3JlX21lZXRpbmcvYnkvdG9tb3Jyb3dfNXBtXCIsIC8vIDktMTlcbiAgXCJzYW11ZWwuY29tbWl0cy50by9maW5pc2hfY2hfMjNfcHJvYmxlbV9zZXQvYnkvdG9kYXlfNl9wbVwiLCAvLyA5LTE5XG4gIFwiZHJlZXYucHJvbWlzZXMudG8vaW50ZXJuX2Rpc2MvYnkvd2VkXCIsIC8vIDktMTksIGRvbmUgZWFybHlcbiAgXCJraW0ucHJvbWlzZXMudG8vZW1haWxfYXJndWVfc3VtbWFyeS9ieS9mcmlcIiwgLy8gOS0xOVxuICBcImRyZWV2LmNvbW1pdHMudG8vY2xlYXJfYm9ndXNfY29tbWl0X2Zvcl9uaWNrL2J5LzVfbWludXRlc19mcm9tX25vd1wiLCAvLyA5LTE5LCBkb25lIGVhcmx5XG4gIFwia2ltLnByb21pc2VzLnRvL3JlZmxlY3RfUmVzcG9uZF9hbnhpZXR5X3NwaXJhbF9Bc3Npc3QvYnkvc2F0XCIsIC8vIDktMTlcbiAgXCJkcmVldi5jb21taXRzLnRvL3NjaGVkdWxlLWtfdGF4X3RoaW5nL2J5LzVwbVwiLCAvLyA5LTE5LCBkb25lXG4gIFwiZHJlZXYucHJvbWlzZXMudG8vc2V0X3VwX21vbV9vbl93b3JkZmV1ZC9ieS90b21vcnJvd1wiLCAvLyA5LTIwLCBkb25lL3ZvaWRcbiAgXCJkcmVldi5wcm9taXNlcy50by9yZXBseV90b191c2VfY2FzZV9lbWFpbC9ieS9taWRuaWdodFwiLCAvLyA5LTIwLCBkb25lIGVhcmx5XG4gIFwia2ltLnByb21pc2VzLnRvL2NvbnNpZGVyX2FsbF93ZWVrZW5kX3NvY2lhbF9vcHRpb25zL2J5L2ZyaS8xMHBtXCIsIC8vIDktMjBcbiAgXCJraW0ucHJvbWlzZXMudG8vc3VibWl0X2NvbmNsdXNpb25fZW1haWwvYnkvMTAvMTZcIiwgLy8gOS0yMVxuICBcImtpbS5wcm9taXNlcy50by9jb21wbGV0ZV90eXBlXzFfZXNzYXkvYnkvMTAvMVwiLCAvLyA5LTIxXG4gIFwia2ltLnByb21pc2VzLnRvL2luZm9ybV9ldmVfcGxhbnMvYnkvMlwiLCAvLyA5LTIxXG4gIFwia2ltLnByb21pc2VzLnRvL2VtYWlsX2N5bnRoaWFfY2hhcmxhcF90aWNrZXRzL2J5LzkvMjJcIiwgLy8gOS0yMVxuICBcImtpbS5wcm9taXNlcy50by9zY2hlZHVsZV9hdHRvcm5leV9tZWV0L2J5LzEwLzFcIiwgLy8gOS0yMVxuICBcImtpbS5wcm9taXNlcy50by9qb2huX1BBTV9waG90b3NfYXNrL2J5LzEwLzFcIiwgLy8gOS0yMVxuICBcImtpbS5wcm9taXNlcy50by9OaWtlX3A1X2VtYWlsL2J5LzEwLzFcIiwgLy8gOS0yMVxuICBcImtpbS5wcm9taXNlcy50by9pbnRyb19tYXJ0aW5fbWFybmEvYnkvMTAvNVwiLCAvLyA5LTIxXG4gIFwia2ltLnByb21pc2VzLnRvL3Nib25vbWljX2ppdHNqdWRnZWxpc3RfZG9jL2J5LzEwLzE1XCIsIC8vIDktMjFcbiAgXCJraW0ucHJvbWlzZXMudG8vY29uc2lkZXJfYWxsX3dlZWtlbmRfc29jaWFsX29wdGlvbnMvYnkvZnJpLzEwcG1cIiwgLy8gOS0yMVxuICBcImRyZWV2LmNvbW1pdHMudG8vZGVkdXBfdGhlX2l3aWxscy9ieS9ub3ZcIiwgLy8gOS0yMlxuICBcImJ5b3JnZXkucHJvbWlzZXMudG8vZW1haWxfY3V0X3Byb3BlcnR5X3N1bW1hcnkvYnkvN3BtXCIsIC8vIDktMjJcbiAgXCJkcmVldi5jb21taXRzLnRvL2NvcHlfZWRpdGluZ19wYXNzX29uX3RhbzIvYnkvdG13XzJwbVwiLCAvLyA5LTIyLCBkb25lXG4gIFwiY2hyaXMucHJvbWlzZXMudG8vb3Blbl9hX3Ntb290aGllX3Nob3AvYnkvRGVjZW1iZXJcIiwgLy8gOS0yNVxuICBcInBpZXJyZS5wcm9taXNlcy50by93YXRlcl90aGVfb2ZmaWNlX3BsYW50L2J5L0ZyaWRheVwiLCAvLyA5LTI1XG4gIFwiZHJlZXYucHJvbWlzZXMudG8vaGFubmFfcmVwbHkvYnkvdG9uaWdodFwiLCAvLyA5LTI2LCBkb25lXG4gIFwiYmVlLnByb21pc2VzLnRvL3JlYWQtaGFubmFzLWVtYWlsc1wiLCAvLyA5LTI2XG4gIFwiYmVlLnByb21pc2VzLnRvL3JlcGluZy1vbmUtd2l0aC1oZWFydFwiLCAvLyA5LTI2XG4gIFwiYmVlLnByb21pc2VzLnRvL2ZpbGwtb3V0LW1ldHJvbWlsZS1mZWVkYmFja1wiLCAvLyA5LTI2XG4gIFwiYmVlLnByb21pc2VzLnRvL3NjaGVkdWxlLXBsYW5uaW5nLXdpdGgtY2FudG9yL2J5L2ZyaWRheS1uaWdodFwiLCAvLyA5LTI2XG4gIFwiZHJlZXYucHJvbWlzZXMudG8vYXNrX2phbmFfYWJvdXRfYmxvb2RfdGVzdGVycy9ieS9kZWNfMVwiLCAvLyA5LTI2XG4gIFwiZHJlZXYuY29tbWl0cy50by90YWtlX2NvcHllZGl0aW5nX3Bhc3Nfb25fbWljaGVsZXNfZHJhZnQvYnkvc2F0dXJkYXlcIiwgLy8gOS8yNyxcbiAgXCJzdGVwaGVuLnByb21pc2VzLnRvL2RlY2lkZV91cG9uX2xhdGVfb2N0b2Jlcl90cmlwL2J5L3NhdHVyZGF5XCIsIC8vIDktMjdcbl1cblxubGV0IHVzZXJzID0gWyBcbiAgXCJhbGljZVwiLCBcImJvYlwiLCBcImNhcm9sXCIsIC8vIHRlc3RpbmdcbiAgXCJkcmVldlwiLCBcInNlcmdpaVwiLCBcImtpbVwiLCBcImJlZVwiLCBcImJyYWRlblwiLCAvLyBpbml0aWFsIGNvLWNvbnNwaXJhdG9yc1xuICBcImJ5b3JnZXlcIiwgXCJuaWNrXCIsIFwiam9zaFwiLCBcImRlaG93ZWxsXCIsIFwiY2FpbGx1XCIsIFwibWJvcmtcIiwgXCJyb3lcIiwgLy8gZGFpbHkgYmVlbWFpbFxuICBcInNhbXVlbFwiLCBcImNvbGVcIiwgXCJqZXNzaWNhXCIsIFwic3RldmVuXCIsIC8vIHdlZWtseSBiZWVtYWlsXG4gIFwiY2hyaXNcIiwgXCJzdGVwaGVuXCIsIC8vIGNvbnRyaWJ1dG9yc1xuICBcInBpZXJyZVwiLCAvLyBpbnZpdGVlc1xuXVxuXG4vKiBcbmxldCB0ZXN0XG4vL3Rlc3QgPSBjaHJvbm8ucGFyc2VEYXRlKFwiZm9vIHRoZSBiYXIgYnkgc2VwIDE1dGggbm9vblwiKVxudGVzdCA9IGNocm9uby5wYXJzZURhdGUoXCJDYWxsX3RoZV9kZW50aXN0IGJ5IDIwMTctMTAtMTUgMTJwbVwiKVxuY29uc29sZS5sb2coYERFQlVHOiAke3Rlc3R9ICh1bml4dGltZSA9ICR7dGVzdC5nZXRUaW1lKCkvMTAwMH1gKVxuY29uc29sZS5sb2coXCJERUJVRzogXCIsIEpTT04uc3RyaW5naWZ5KHBhcnNlUHJvbShwcm9taXNlc1syXSkpKVxuKi9cblxudmFyIFByb21pc2VcblxuLy8gc2V0IHVwIGEgbmV3IGRhdGFiYXNlIHVzaW5nIGRhdGFiYXNlIGNyZWRlbnRpYWxzIHNldCBpbiAuZW52XG52YXIgc2VxdWVsaXplID0gbmV3IFNlcXVlbGl6ZSgnZGF0YWJhc2UnLCBwcm9jZXNzLmVudi5EQl9VU0VSLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3MuZW52LkRCX1BBU1MsIHtcbiAgaG9zdDogJzAuMC4wLjAnLFxuICBkaWFsZWN0OiAnc3FsaXRlJyxcbiAgcG9vbDoge1xuICAgIG1heDogNSxcbiAgICBtaW46IDAsXG4gICAgaWRsZTogMTAwMDAsXG4gIH0sXG4gIC8vIFNlY3VyaXR5IG5vdGU6IGRiIGlzIHNhdmVkIHRvIGAuZGF0YS9kYXRhYmFzZS5zcWxpdGVgIGluIGxvY2FsIGZpbGVzeXN0ZW0uXG4gIC8vIE5vdGhpbmcgaW4gYC5kYXRhYCBkaXJlY3RvcnkgZ2V0cyBjb3BpZWQgaWYgc29tZW9uZSByZW1peGVzIHRoZSBwcm9qZWN0LlxuICBzdG9yYWdlOiAnLmRhdGEvZGF0YWJhc2Uuc3FsaXRlJ1xufSk7XG5cbi8vIGF1dGhlbnRpY2F0ZSB3aXRoIHRoZSBkYXRhYmFzZVxuc2VxdWVsaXplLmF1dGhlbnRpY2F0ZSgpXG4gIC50aGVuKGZ1bmN0aW9uKGVycikge1xuICAgIGNvbnNvbGUubG9nKCdDb25uZWN0aW9uIGhhcyBiZWVuIGVzdGFibGlzaGVkIHN1Y2Nlc3NmdWxseS4nKVxuICAgIC8vIGRlZmluZSBhIG5ldyB0YWJsZSAncHJvbWlzZXMnXG4gICAgUHJvbWlzZSA9IHNlcXVlbGl6ZS5kZWZpbmUoJ3Byb21pc2VzJywge1xuICAgICAgdXJ0eDogeyB0eXBlOiBTZXF1ZWxpemUuU1RSSU5HICB9LCAvLyB1cnRleHQsIGluY2x1ZGluZyB3aG9sZSBVUkxcbiAgICAgIHVzZXI6IHsgdHlwZTogU2VxdWVsaXplLlNUUklORyAgfSwgLy8gd2hvJ3MgbWFraW5nIHRoZSBwcm9taXNlXG4gICAgICB3aGF0OiB7IHR5cGU6IFNlcXVlbGl6ZS5TVFJJTkcgIH0sIC8vIHdoYXQncyBiZWluZyBwcm9taXNlZFxuICAgICAgLy93aG9tOiB7IHR5cGU6IFNlcXVlbGl6ZS5TVFJJTkcgIH0sIC8vIHRvIHdob20gYXJlIHlvdSBwcm9taXNpbmdcbiAgICAgIHRpbmk6IHsgdHlwZTogU2VxdWVsaXplLklOVEVHRVIgfSwgLy8gdW5peHRpbWUgdGhhdCBwcm9taXNlIHdhcyBtYWRlXG4gICAgICB0ZHVlOiB7IHR5cGU6IFNlcXVlbGl6ZS5TVFJJTkcgfSwgLy8gdW5peHRpbWUgdGhhdCB0aGUgcHJvbWlzZSBpcyBkdWVcbiAgICAgIC8vdG16bjogeyB0eXBlOiBTZXF1ZWxpemUuU1RSSU5HICB9LCAvLyB0aW1lem9uZVxuICAgICAgLy93dGRpZDogeyB0eXBlOiBTZXF1ZWxpemUuSU5URUdFUiB9LCAvLyB1bml4dGltZSB0aGF0IHRoZSBwcm9taXNlIHdhcyBmdWxmaWxsZWRcbiAgICAgIC8vZmlsbDogeyB0eXBlOiBTZXF1ZWxpemUuRkxPQVQgICB9LCAvLyBmcmFjdGlvbiBmdWxmaWxsZWRcbiAgICAgIC8vdm9pZDogeyB0eXBlOiBTZXF1ZWxpemUuQk9PTEVBTiB9LCAvLyB3aGV0aGVyIHByb21pc2Ugd2FzIHZvaWRlZFxuICAgICAgLy8gdGV4dDogICB7IHR5cGU6IFNlcXVlbGl6ZS5TVFJJTkcgfSwgLy8gdGhpcyB3YXMganVzdCBmb3IgdGVzdGluZ1xuICAgIH0pOyAgICBcbiAgICAvL3NldHVwKClcbiAgfSlcbiAgLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICBjb25zb2xlLmxvZygnVW5hYmxlIHRvIGNvbm5lY3QgdG8gdGhlIGRhdGFiYXNlOiAnLCBlcnIpXG4gIH0pXG5cbi8vIHBvcHVsYXRlIHRhYmxlIHdpdGggaGFyZGNvZGVkIHByb21pc2VzIGFib3ZlXG5mdW5jdGlvbiBzZXR1cCgpIHsgXG4gIFByb21pc2Uuc3luYyh7Zm9yY2U6IHRydWV9KSAvLyAnZm9yY2U6IHRydWUnIGp1c3QgZHJvcHMgdGhlIHRhYmxlIGlmIGl0IGV4aXN0c1xuICAgIC50aGVuKGZ1bmN0aW9uKCl7ICAgICAgICAgLy8gYW5kIGNyZWF0ZXMgYSBuZXcgb25lIVxuICAgICAgLy8gQWRkIHRoZSBkZWZhdWx0IHByb21pc2VzIHRvIHRoZSBkYXRhYmFzZVxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9taXNlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBQcm9taXNlLmNyZWF0ZShwYXJzZVByb20ocHJvbWlzZXNbaV0pKVxuICAgICAgfVxuICAgIH0pXG59XG5cbmFwcC5nZXQoJy9wcm9taXNlLzp1ZHAvOnVydHgnLCBmdW5jdGlvbihyZXEsIHJlc3ApIHtcbiAgbGV0IHVydHggPSByZXEub3JpZ2luYWxVcmwuc3Vic3RyKDkpXG4gIFByb21pc2UuZmluZE9uZSh7IHdoZXJlOiB7dXJ0eH19KVxuICAgIC50aGVuKGZ1bmN0aW9uKHByb21pc2UpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdzaW5nbGUgcHJvbWlzZScsIHVydHgsIHByb21pc2UpXG4gICAgLy8gcmVzcC53cml0ZShwcm9taXNlKVxuICAgIHJlc3AuanNvbihwcm9taXNlKVxuICB9KVxuXG59KVxuXG5hcHAuZ2V0KCcvJywgKHJlcSwgcmVzcCkgPT4geyBcbiAgcmVzcC5zZW5kRmlsZShfX2Rpcm5hbWUgKyAnL3B1YmxpYy9pbmRleC5odG1sJykgXG59KVxuXG5hcHAuZ2V0KCcvcHJvbWlzZXMnLCBmdW5jdGlvbihyZXEsIHJlc3ApIHtcbiAgdmFyIGRiUHJvbWlzZXMgPSB7fVxuICBQcm9taXNlLmZpbmRBbGwoe1xuICAgIG9yZGVyOiBzZXF1ZWxpemUubGl0ZXJhbCgndGluaSBERVNDJylcbiAgfSkudGhlbihmdW5jdGlvbihwcm9taXNlcykge1xuICAgIGNvbnNvbGUubG9nKCdhOzsgcHJvbWlzZXMnLCBwcm9taXNlcylcbiAgICBwcm9taXNlcy5mb3JFYWNoKGZ1bmN0aW9uKHByb21pc2UpIHtcbiAgICAgIGRiUHJvbWlzZXNbcHJvbWlzZS51c2VyXSA9IGRiUHJvbWlzZXNbcHJvbWlzZS51c2VyXSB8fCBbXVxuICAgICAgZGJQcm9taXNlc1twcm9taXNlLnVzZXJdLnB1c2gocHJvbWlzZSkgLy8gYWRkcyB0aGVpciBpbmZvIHRvIGRiUHJvbWlzZXMgdmFsdWVcbiAgICB9KTtcbiAgICByZXNwLnNlbmQoZGJQcm9taXNlcykgLy8gc2VuZHMgZGJQcm9taXNlcyBiYWNrIHRvIHRoZSBwYWdlXG4gIH0pXG59KVxuXG5hcHAuZ2V0KCcvcHJvbWlzZXMvOnVzZXInLCBmdW5jdGlvbihyZXEsIHJlc3ApIHtcbiAgdmFyIGRiUHJvbWlzZXMgPSBbXTtcbiAgUHJvbWlzZS5maW5kQWxsKHtcbiAgIHdoZXJlOiB7XG4gICAgIHVzZXI6IHJlcS5wYXJhbXMudXNlclxuICAgfSxcbiAgfSkudGhlbihmdW5jdGlvbihwcm9taXNlcykge1xuICAgIGNvbnNvbGUubG9nKCd1c2VyIHByb21pc2VzJywgcHJvbWlzZXMpO1xuICAgIHByb21pc2VzLmZvckVhY2goZnVuY3Rpb24ocHJvbWlzZSkge1xuICAgICAgZGJQcm9taXNlcy5wdXNoKHByb21pc2UpIC8vIGFkZHMgdGhlaXIgaW5mbyB0byBkYlByb21pc2VzIHZhbHVlXG4gICAgfSk7XG4gICAgcmVzcC5zZW5kKGRiUHJvbWlzZXMpIC8vIHNlbmRzIGRiUHJvbWlzZXMgYmFjayB0byB0aGUgcGFnZVxuICB9KVxufSlcblxuYXBwLmdldCgnL3Byb21pc2VzL3JlbW92ZS86dXJ0eCcsIChyZXEsIHJlc3ApID0+IHtcbiAgUHJvbWlzZS5maW5kQWxsKHtcbiAgIHdoZXJlOiB7XG4gICAgIHVzZXI6IHJlcS5wYXJhbXMudXNlclxuICAgfSxcbiAgfSlcbn0pXG5cbi8vIGNyZWF0ZXMgYSBuZXcgZW50cnkgaW4gdGhlIHByb21pc2VzIHRhYmxlIHdpdGggdGhlIHN1Ym1pdHRlZCB2YWx1ZXNcbmFwcC5wb3N0KCcvcHJvbWlzZXMnLCAocmVxLCByZXNwKSA9PiB7XG4gIGNvbnNvbGUubG9nKCdwcm9taXNlIHJlcScsIHJlcSwgcmVzcCk7XG4gIFByb21pc2UuY3JlYXRlKHsgdGV4dDogcmVxLnF1ZXJ5LnByb21pc2UgfSlcbiAgcmVzcC5zZW5kU3RhdHVzKDIwMClcbn0pXG5cbmFwcC5nZXQoJy9yZXNldCcsIChyZXEsIHJlc3ApID0+IHtcbiAgc2V0dXAoKVxuICByZXNwLnJlZGlyZWN0KCcvJylcbn0pXG5cbi8vIHJlbW92ZXMgYWxsIGVudHJpZXMgZnJvbSB0aGUgcHJvbWlzZXMgdGFibGVcbmFwcC5nZXQoJy9jbGVhcicsIChyZXEsIHJlc3ApID0+IHtcbiAgUHJvbWlzZS5kZXN0cm95KHt3aGVyZToge319KVxuICByZXNwLnJlZGlyZWN0KCcvJylcbn0pXG5cbi8qXG5MaXR0bGUgcGljdHVyZTogV2h5IGRvZXMgdGhpcyBlcnJvciBoYW5kbGluZyBjb2RlIG5vdCBydW4gd2hlbiBJIHN1cmYgdG8gXG5hIGJhZCBVUkwgbGlrZSBpd2lsbC5nbGl0Y2gubWUvZm9vJWJhclxuXG5CaWdnZXIgcGljdHVyZTogSSdtIG1ha2luZyBhbiBhcHAgdGhhdCBuZWVkcyB0byBwcm9jZXNzIGFueSBVUkwgdGhlIHVzZXIgbWF5IFxudGhyb3cgYXQgaXQuIEkgbmVlZCB0aGUgc2VydmVyIHRvIGdldCB0aGUgZXhhY3QgVVJMIHRoZSB3YXkgdGhlIHVzZXIgc2VlcyBpdCBpbiBcbnRoZSBicm93c2VyLiBUaGF0J3MgZ29pbmcgdG8gYmUgZXNwZWNpYWxseSB0cmlja3kgZm9yIHRoaW5ncyBsaWtlICcjJyBjaGFyYWN0ZXJzXG5idXQgcmlnaHQgbm93IEknbSBqdXN0IHRyeWluZyB0byBmaWd1cmUgb3V0IHRoZSBjYXNlIG9mIGFyYml0cmFyeSAnJScgY2hhcmFjdGVyc1xudGhhdCBtYXkgbm90IGNvcnJlc3BvbmQgdG8gcHJvcGVyICUtZW5jb2RpbmdzLlxuXG5JJ20gdGhpbmtpbmcgbGlrZSBhIGNhdGNoYWxsIGVycm9yLWhhbmRsaW5nIHJvdXRlIHRoYXQgbm8gbWF0dGVyIHdoYXQgd2VpcmRcbmVuY29kaW5nIG9yIHdoYXRldmVyIGVycm9yIGlzIHRocm93biBJIGNhbiBzdGlsbCBoYXZlIHRoZSBjb2RlIGhlcmUgZG8gc29tZXRoaW5nXG53aXRoIHRoZSBVUkwgYXMgdGhlIHVzZXIgdHlwZWQgaXQuXG5cbkZvciBub3cgd2UncmUganVzdCBkcm9wcGluZyBhbGwgdGhpcyBhbmQgaGF2aW5nIHRoZSBhcHAgZ2l2ZSB0aGUgdXNlciBhbiBlcnJvclxuaWYgdGhlcmUgYXJlIGFueSB3ZWlyZCBjaGFyYWN0ZXJzIGluIHRoZSBVUkwuXG5cbmFwcC51c2UoZnVuY3Rpb24ocmVxLCByZXNwLCBuZXh0KSB7XG4gIHZhciBlcnIgPSBudWxsXG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coXCJUUllJTkdcIiwgcmVxLnBhdGgsIHJlcS51cmwpXG4gICAgZGVjb2RlVVJJQ29tcG9uZW50KHJlcS5wYXRoKVxuICB9IGNhdGNoKGUpIHtcbiAgICBlcnIgPSBlXG4gIH1cbiAgaWYgKGVycikge1xuICAgIGNvbnNvbGUubG9nKFwiQ0FVR0hUIEVSUjpcIiwgZXJyLCByZXEudXJsKVxuICAgIHJldHVybiByZXNwLnJlZGlyZWN0KCcvJylcbiAgfVxuICBuZXh0KCk7XG5cbiAgLy9jb25zb2xlLmxvZyhcIkRFQlVHIFVTRTE6XCIsIHJlcS5vcmlnaW5hbFVybClcbiAgLy9yZXNwLnJlZGlyZWN0KCcvJylcbn0pXG4qL1xuXG5hcHAuYWxsKCcqJywgKHJlcSwgcmVzcCkgPT4ge1xuICAvLyBUaGUgc2VydmVyIGF0IHByb21pc2VzLnRvIHBhc3NlcyBhbG9uZyB0aGUgZnVsbCBVUkwgdGhlIHdheSB0aGUgdXNlciB0eXBlZFxuICAvLyBpdCwgc28gd2hlbiB0aGUgdXNlciBoaXRzIFwiYm9iLnByb21pc2VzLnRvL2Zvb1wiIHRoZSBHbGl0Y2ggYXBwIGlzIGNhbGxlZFxuICAvLyB3aXRoIFwiaXdpbGwuZ2xpdGNoLm1lL2JvYi5wcm9taXNlcy50by9mb29cIiBhbmQgcmVxLm9yaWdpbmFsVXJsIGlzXG4gIC8vIFwiL2JvYi5wcm9taXNlcy50by9mb29cIiAob3JpZ2luYWxVcmwgZG9lc24ndCBpbmNsdWRlIHRoZSBob3N0bmFtZSlcbiAgbGV0IHVydHggPSByZXEub3JpZ2luYWxVcmwuc3Vic3RyKDEpIC8vIGdldCByaWQgb2YgdGhlIGluaXRpYWwgc2xhc2hcbiAgLy8gdXJ0eCBpcyBub3csIGVnLCBcImJvYi5wcm9taXNlcy50by9mb29fdGhlX2Jhci9ieS85YW1cIlxuICBcbiAgLy8gVE9ETzogZG9uJ3QgdHJ5IHRvIHBhcnNlIGEgcHJvbWlzZSBpZiBubyBzdWJkb21haW4sIGllLCBubyB1c2VyIGdpdmVuXG4gIC8vIFRPRE9MQVRFUjogaG93IHRvIGhhbmRsZSBcImJvYi5wcm9taXNlcy50by9mb28lYmFyXCJcbiAgLy8gVE9ET0xBVEVSOiBuZWVkIHRvIHVybC1kZWNvZGUgdG8gaGFuZGxlIFwiYm9iLnByb21pc2VzLnRvL2Zvb15iYXJcIlxuICAvLyBUT0RPTEFURVI6IGhhbmRsZSBib2IucHJvbWlzZXMudG8vZG9faXRlbV8jMi9ieS85YW1cbiAgLy8gICAgICAgICAgIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzE4Nzk2NDIxL2NhcHR1cmUtYW5jaG9yLWxpbmtzXG4gIFxuICBjb25zb2xlLmxvZyhcIkRFQlVHIHVydHg6XCIsIHVydHgpXG4gIC8vIFBhcnNlIHRoZSB1cnRleHQgaW50byB1c2VyLCB3aGF0LCB3aG9tLCB0aW5pLCB0ZHVlLCBldGNcbiAgLy8gQ2hlY2sgaWYgYSBwcm9taXNlIGFscmVhZHkgZXhpc3RzIHdpdGggbWF0Y2hpbmcgdXNlcisnfCcrd2hhdFxuICAvLyBJZiBub3QsIGNyZWF0ZSBpdFxuICAvLyBJZiBzbywgZG8gbm90aGluZ1xuICBsZXQgcCA9IHBhcnNlUHJvbSh1cnR4KVxuICAvLyBUT0RPOiBpZiB0aGUgdXJsIHdhcyBqdXN0IGFsaWNlLnByb21pc2VzLnRvIHRoZW4gd2Ugd2FudCB0byBzaG93IGFsaWNlJ3NcbiAgLy8gc3RhdGlzdGljcyBhbmQgbGlzdCBvZiBwcm9taXNlcyBhbmQgZXZlcnl0aGluZ1xuICBpZiAocC51c2VyID09PSAnd3d3JyB8fCBwLnVzZXIgPT09ICcnKSB7IFxuICAgIC8vIFRPRE86IHRoaXMgaXMgdGhlIGNhc2Ugb2Ygbm8gdXNlcm5hbWUsIGxpa2UgaWYgc29tZW9uZSBqdXN0IHdlbnQgdG9cbiAgICAvLyBcInByb21pc2VzLnRvXCIgb3IgdHJpZWQgdG8gZmV0Y2ggXCJwcm9taXNlcy50by9yb2JvdHMudHh0XCIgb3Igd2hhdGV2ZXJcbiAgICByZXNwLnNlbmRGaWxlKF9fZGlybmFtZSArICcvcHVibGljL2luZGV4Lmh0bWwnKSBcbiAgfSBlbHNlIGlmICghdXNlcnMuaW5jbHVkZXMocC51c2VyKSkge1xuICAgIC8vIFRPRE86IHRlbGwgdXNlciBcIlNvcnJ5LCBubyBzdWNoIHVzZXIhIEdldCBpbiB0b3VjaCBpZiB5b3Ugd2FudCB0byBnZXQgaW5cbiAgICAvLyBvbiBvdXIgYmV0YSFcIlxuICAgIHJlc3Auc2VuZEZpbGUoX19kaXJuYW1lICsgJy9wdWJsaWMvaW5kZXguaHRtbCcpXG4gIH0gZWxzZSB7XG4gICAgUHJvbWlzZS5maW5kT25lKHsgd2hlcmU6IHt1cnR4fSB9KVxuICAgICAgLnRoZW4ocHJvbWlzZSA9PiB7XG4gICAgICAgIGlmIChwcm9taXNlKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ2R1cGxpY2F0ZScsIHVydHgpO1xuICAgICAgICAgIHJlc3AucmVkaXJlY3QoYC9wcm9taXNlLyR7dXJ0eH1gKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBQcm9taXNlLmNyZWF0ZShwKTtcbiAgICAgICAgICBtYWlsc2VsZignUFJPTUlTRScsIHVydHgpO1xuICAgICAgICB9XG4gICAgfSlcbiBcbiAgICByZXNwLnNlbmRGaWxlKF9fZGlybmFtZSArICcvcHVibGljL2luZGV4Lmh0bWwnKSBcbiAgfVxufSlcblxudmFyIGxpc3RlbmVyID0gYXBwLmxpc3Rlbihwcm9jZXNzLmVudi5QT1JULCBmdW5jdGlvbigpIHtcbiAgY29uc29sZS5sb2coJ1Byb21pc2VzIGFwcCBpcyBsaXN0ZW5pbmcgb24gcG9ydCAnICsgbGlzdGVuZXIuYWRkcmVzcygpLnBvcnQpXG59KVxuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gODBjaGFycyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tPlxuIl19",
    "ast": null,
    "map": {
      "version": 3,
      "sources": [
        "server.js"
      ],
      "names": [
        "express",
        "require",
        "Sequelize",
        "app",
        "chrono",
        "Mailgun",
        "moment",
        "use",
        "static",
        "mailself",
        "subj",
        "body",
        "mailgun",
        "apiKey",
        "process",
        "env",
        "MAILGUN_KEY",
        "domain",
        "MAILGUN_DOMAIN",
        "data",
        "from",
        "MAILGUN_FROM",
        "to",
        "MY_EMAIL",
        "subject",
        "text",
        "messages",
        "send",
        "err",
        "parseProm",
        "urtx",
        "m",
        "match",
        "user",
        "path",
        "what",
        "tdue",
        "Date",
        "now",
        "length",
        "parsedPath",
        "console",
        "log",
        "tini",
        "credit",
        "t",
        "promises",
        "users",
        "Promise",
        "sequelize",
        "DB_USER",
        "DB_PASS",
        "host",
        "dialect",
        "pool",
        "max",
        "min",
        "idle",
        "storage",
        "authenticate",
        "then",
        "define",
        "type",
        "STRING",
        "INTEGER",
        "catch",
        "setup",
        "sync",
        "force",
        "i",
        "create",
        "get",
        "req",
        "resp",
        "originalUrl",
        "substr",
        "findOne",
        "where",
        "promise",
        "json",
        "sendFile",
        "__dirname",
        "dbPromises",
        "findAll",
        "order",
        "literal",
        "forEach",
        "push",
        "params",
        "post",
        "query",
        "sendStatus",
        "redirect",
        "destroy",
        "all",
        "p",
        "includes",
        "listener",
        "listen",
        "PORT",
        "address",
        "port"
      ],
      "mappings": "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",
      "file": "server.js",
      "sourceRoot": "/app",
      "sourcesContent": [
        "// --------------------------------- 80chars ---------------------------------->\nvar express = require('express')\nvar Sequelize = require('sequelize')\nvar app = express()\nvar chrono = require('chrono-node') // Sugar.js parses some things better\nvar Mailgun = require('mailgun-js')\nvar moment = require('moment')\n\n// DATABASE FIELDS:\n//   urtx -- urtext, ie, full original text the user typed to create the promise\n//   user -- who's making the promise\n//   what -- what's being promised\n//   whom -- to whom are you promising\n//   tini -- unixtime that the promise was made\n//   tdue -- unixtime that the promise is due\n//   tmzn -- timezone assumed for parsing the deadline\n//   tfin -- unixtime that the promise was fulfilled\n//   fill -- fraction fulfilled, default 0\n//   void -- true if the promise became unfulfillable or moot\n//   clix -- number of clicks a promise has gotten\n// For example:\n//   urtx = \"bob.promises.to/foo_the_bar/by/noon_tomorrow\"\n//   user = \"bob\"\n//   what = \"foo the bar\"\n//   whom = null\n//   tini = [unixtime of first GET request of the promise's URL]\n//   tdue = [what \"noon tomorrow\" parsed to at time tini]\n//   tmzn = \"America/Los_Angeles\"\n//   tfin = [unixtime that the promise was fulfilled]\n//   fill = 0\n//   void = false\n\n// Other ideas for fields: \n// * information about the client that originally created the promise\n// * whether the promise was created by the actual user (if they were logged in \n//   and were the first to click on it) or by another logged-in user or by \n//   someone not logged in\n// * conf: maybe we create the promise whether or not anyone clicks the button to confirm\n//   it, in which case we store when it's actually been confirmed.\n\n// LATEST SPEC:\n// The \"/by/...\" part is an optional power-user thing, not part of the MVP.\n// Instead, the first time you go to alice.promises.to/foo it gives you the \n// option to choose a deadline, defaulting to now+7days (or to what the \"/by/\" \n// part parsed to, if that's easy, but just make it a suggestion for the user, \n// just like now+7days is if they don't specify a \"/by/\"). \n// For every subsequent GET of alice.promises.to/foo it shows the deadline, with\n// no way to change it.\n\n// IDEAS FOR LATER:\n// Simpler date parsing:\n//   Maybe the date has to be YYYY-MM-DD_HH:MM\n//   Example: bob.promises.to/foo_the_bar/by/2017-09-13_12:00\n// Magic spaces:\n//   Whichever non-alphanumeric character is most common in the urtext, that's \n//   what's assumed to be a space and is replaced with spaces before parsing.\n// Less magical version:\n//   A non-alphanumeric character must follow \"alice.promises.to/\" and that\n//   character is taken as the ersatz space. Eg:\n//   alice.promises.to/_start_her_promises_with_underscores\n// Flexibility on the '/by/' part:\n//   Requiring the string '/by/' to appear in the promise URL means no ambiguity\n//   about where to start parsing the deadline. But the Chrono parsing library \n//   actually does great taking the whole string like \"foo the bar by noon \n//   tomorrow\" and figuring out the time. We could also just take the last\n//   occurrence of \"by\" and parse everything after it as the deadline.\n\napp.use(express.static('public'))\n\nfunction mailself(subj, body) {\n  var mailgun = new Mailgun({apiKey: process.env.MAILGUN_KEY, \n                             domain: process.env.MAILGUN_DOMAIN})\n  var data = {\n    from:    process.env.MAILGUN_FROM,\n    to:      process.env.MY_EMAIL,\n    subject: subj,\n    text:    body,\n  }\n  mailgun.messages().send(data, (err, body) => {})\n}\n\n// Take urtext and return a promise data structure\nfunction parseProm(urtx) {\n  let m = urtx.match(/^([^\\.]+)\\.(promises|commits)\\.to\\/(.*)$/)\n  // TODO: handle the case that no user is given, just \"promises.to/foo\"\n  let user = m ? m[1] : ''\n  let domain = m ? m[2] : ''\n  let path = m ? m[3] : ''\n  let what = ''\n  let tdue = Date.now() + 7*24*60*60*1000\n  if (path.length > 0) {\n    let parsedPath = path.match(/^(.*?)(\\/by\\/|$)(.*)$/)\n    what = parsedPath[1] //.replace(/_/g, ' ')\n    //tdue = parsedPath.length > 1 ? \n    //       chrono.parseDate(parsedPath[3].replace(/_/g, ' ')) * 1 : \n    //       Date.now() + 7*24*60*60*1000\n    //tdue = tdue ? ( ( tdue < Date.now() && Date.now() - tdue < 24*60*60*1000 ) ?\n    //                tdue + 24*60*60*1000 : tdue )\n    //            : Date.now() + 7*24*60*60*1000\n    tdue = parsedPath[3]\n  }\n  // TODO: path is now everything after \".promises.to\" so now parse out the \n  //       \"what\" (thing being promised) and the \"tdue\" (deadline)\n  console.log('parseProm', { user, path, domain, what, tdue, urtx })\n  return { user, path, domain, what, tdue, urtx, tini: Date.now() }\n}\n\n// Compute the credit you get for being t seconds late\nfunction credit(t) {\n  // see latepenalty.js\n  return 1\n}\n\n// Initial promise list hardcoded so don't have to worry about blowing db away\nlet promises = [\n  \"alice.promises.to/File_the_TPS_report/by/noon_mon\",\n  \"bob.promises.to/Send_vacation_photos/by/saturday\",\n  \"carol.promises.to/Call_the_dentist/by/12am\",\n  \"dreev.promises.to/show_sergii_this_doing_something_useful/by/3am\", // 9-10, done\n  \"dreev.promises.to/show_bee_open_questions/by/10:30pm\", // 9-10, done\n  \"braden.promises.to/help_with_javascript/by/5pm\", // 9-11\n  \"dreev.promises.to/show_brennan_intro/by/10:50pm\", // 9-11, done\n  \"dreev.promises.to/queue_tweet_etc_for_blog_post/by/2pm\", // 9-11, done\n  \"dreev.promises.to/order_indian/by/5:30pm\", // 9-12, done\n  \"dreev.commits.to/ask_bee_re_sunday_parkways\", // 9-13, done\n  \"dreev.commits.to/follow_up_with_everyone_re_guest_blogging\", // 9-13\n  \"josh.commits.to/get_realisies_running/by/september_30\", // 9-13\n  \"braden.commits.to/outline_bite_counting_post/by/Sunday_11pm\", // 9-13\n  \"dreev.commits.to/report_glitch_bug\", // 9-14\n  \"dreev.commits.to/googledocify_intern_form/by/12pm\", // 9-14\n  \"dreev.promises.to/test_penalty_func/by/saturday_noon\", // 9-14\n  \"sergii.promises.to/work_on_points_2_to_4/by/next_monday\", // 9-14\n  \"dreev.commits.to/meta_debrief_kim/by/midnight_friday\", // 9-14\n  \"dreev.commits.to/ping_mirabai/by/sep_22\", // 9-14\n  \"dreev.commits.to/send_ms_gross_email/by/sunday_11am\", // 9-14\n  \"dreev.promises.to/ping_oli/by/nov_16\", // 9-15\n  \"dreev.promises.to/ping_byorgey/by/dec_20\", // 9-15\n  \"dreev.promises.to/labelzero/by/1am\", // 9-15\n  \"chris.promises.to/follow_up_on_that_support_thread\", // 9-18\n  \"bee.commits.to/new-family-photo-to-yoko/by/tomorrow-night\", // 9-18, done early\n  \"bee.commits.to/rest-of-paperwork-to-yoko-before-the-gym-tomorrow\", // 9-18, 2 hours late\n  \"dreev.promises.to/debug_capitalization/by/tomorrow\", // 9-18, done 23.4 hours late\n  \"bee.commits.to/email-sleep-as-android-for-specifics-about-sleep-length-measurement\", // 9-19\n  \"jessica.commits.to/let_bob_know_re_meeting/by/tomorrow_5pm\", // 9-19\n  \"samuel.commits.to/finish_ch_23_problem_set/by/today_6_pm\", // 9-19\n  \"dreev.promises.to/intern_disc/by/wed\", // 9-19, done early\n  \"kim.promises.to/email_argue_summary/by/fri\", // 9-19\n  \"dreev.commits.to/clear_bogus_commit_for_nick/by/5_minutes_from_now\", // 9-19, done early\n  \"kim.promises.to/reflect_Respond_anxiety_spiral_Assist/by/sat\", // 9-19\n  \"dreev.commits.to/schedule-k_tax_thing/by/5pm\", // 9-19, done\n  \"dreev.promises.to/set_up_mom_on_wordfeud/by/tomorrow\", // 9-20, done/void\n  \"dreev.promises.to/reply_to_use_case_email/by/midnight\", // 9-20, done early\n  \"kim.promises.to/consider_all_weekend_social_options/by/fri/10pm\", // 9-20\n  \"kim.promises.to/submit_conclusion_email/by/10/16\", // 9-21\n  \"kim.promises.to/complete_type_1_essay/by/10/1\", // 9-21\n  \"kim.promises.to/inform_eve_plans/by/2\", // 9-21\n  \"kim.promises.to/email_cynthia_charlap_tickets/by/9/22\", // 9-21\n  \"kim.promises.to/schedule_attorney_meet/by/10/1\", // 9-21\n  \"kim.promises.to/john_PAM_photos_ask/by/10/1\", // 9-21\n  \"kim.promises.to/Nike_p5_email/by/10/1\", // 9-21\n  \"kim.promises.to/intro_martin_marna/by/10/5\", // 9-21\n  \"kim.promises.to/sbonomic_jitsjudgelist_doc/by/10/15\", // 9-21\n  \"kim.promises.to/consider_all_weekend_social_options/by/fri/10pm\", // 9-21\n  \"dreev.commits.to/dedup_the_iwills/by/nov\", // 9-22\n  \"byorgey.promises.to/email_cut_property_summary/by/7pm\", // 9-22\n  \"dreev.commits.to/copy_editing_pass_on_tao2/by/tmw_2pm\", // 9-22, done\n  \"chris.promises.to/open_a_smoothie_shop/by/December\", // 9-25\n  \"pierre.promises.to/water_the_office_plant/by/Friday\", // 9-25\n  \"dreev.promises.to/hanna_reply/by/tonight\", // 9-26, done\n  \"bee.promises.to/read-hannas-emails\", // 9-26\n  \"bee.promises.to/reping-one-with-heart\", // 9-26\n  \"bee.promises.to/fill-out-metromile-feedback\", // 9-26\n  \"bee.promises.to/schedule-planning-with-cantor/by/friday-night\", // 9-26\n  \"dreev.promises.to/ask_jana_about_blood_testers/by/dec_1\", // 9-26\n  \"dreev.commits.to/take_copyediting_pass_on_micheles_draft/by/saturday\", // 9/27,\n  \"stephen.promises.to/decide_upon_late_october_trip/by/saturday\", // 9-27\n]\n\nlet users = [ \n  \"alice\", \"bob\", \"carol\", // testing\n  \"dreev\", \"sergii\", \"kim\", \"bee\", \"braden\", // initial co-conspirators\n  \"byorgey\", \"nick\", \"josh\", \"dehowell\", \"caillu\", \"mbork\", \"roy\", // daily beemail\n  \"samuel\", \"cole\", \"jessica\", \"steven\", // weekly beemail\n  \"chris\", \"stephen\", // contributors\n  \"pierre\", // invitees\n]\n\n/* \nlet test\n//test = chrono.parseDate(\"foo the bar by sep 15th noon\")\ntest = chrono.parseDate(\"Call_the_dentist by 2017-10-15 12pm\")\nconsole.log(`DEBUG: ${test} (unixtime = ${test.getTime()/1000}`)\nconsole.log(\"DEBUG: \", JSON.stringify(parseProm(promises[2])))\n*/\n\nvar Promise\n\n// set up a new database using database credentials set in .env\nvar sequelize = new Sequelize('database', process.env.DB_USER, \n                                          process.env.DB_PASS, {\n  host: '0.0.0.0',\n  dialect: 'sqlite',\n  pool: {\n    max: 5,\n    min: 0,\n    idle: 10000,\n  },\n  // Security note: db is saved to `.data/database.sqlite` in local filesystem.\n  // Nothing in `.data` directory gets copied if someone remixes the project.\n  storage: '.data/database.sqlite'\n});\n\n// authenticate with the database\nsequelize.authenticate()\n  .then(function(err) {\n    console.log('Connection has been established successfully.')\n    // define a new table 'promises'\n    Promise = sequelize.define('promises', {\n      urtx: { type: Sequelize.STRING  }, // urtext, including whole URL\n      user: { type: Sequelize.STRING  }, // who's making the promise\n      what: { type: Sequelize.STRING  }, // what's being promised\n      //whom: { type: Sequelize.STRING  }, // to whom are you promising\n      tini: { type: Sequelize.INTEGER }, // unixtime that promise was made\n      tdue: { type: Sequelize.STRING }, // unixtime that the promise is due\n      //tmzn: { type: Sequelize.STRING  }, // timezone\n      //wtdid: { type: Sequelize.INTEGER }, // unixtime that the promise was fulfilled\n      //fill: { type: Sequelize.FLOAT   }, // fraction fulfilled\n      //void: { type: Sequelize.BOOLEAN }, // whether promise was voided\n      // text:   { type: Sequelize.STRING }, // this was just for testing\n    });    \n    //setup()\n  })\n  .catch(function (err) {\n    console.log('Unable to connect to the database: ', err)\n  })\n\n// populate table with hardcoded promises above\nfunction setup() { \n  Promise.sync({force: true}) // 'force: true' just drops the table if it exists\n    .then(function(){         // and creates a new one!\n      // Add the default promises to the database\n      for (var i = 0; i < promises.length; i++) {\n        Promise.create(parseProm(promises[i]))\n      }\n    })\n}\n\napp.get('/promise/:udp/:urtx', function(req, resp) {\n  let urtx = req.originalUrl.substr(9)\n  Promise.findOne({ where: {urtx}})\n    .then(function(promise) {\n      console.log('single promise', urtx, promise)\n    // resp.write(promise)\n    resp.json(promise)\n  })\n\n})\n\napp.get('/', (req, resp) => { \n  resp.sendFile(__dirname + '/public/index.html') \n})\n\napp.get('/promises', function(req, resp) {\n  var dbPromises = {}\n  Promise.findAll({\n    order: sequelize.literal('tini DESC')\n  }).then(function(promises) {\n    console.log('a;; promises', promises)\n    promises.forEach(function(promise) {\n      dbPromises[promise.user] = dbPromises[promise.user] || []\n      dbPromises[promise.user].push(promise) // adds their info to dbPromises value\n    });\n    resp.send(dbPromises) // sends dbPromises back to the page\n  })\n})\n\napp.get('/promises/:user', function(req, resp) {\n  var dbPromises = [];\n  Promise.findAll({\n   where: {\n     user: req.params.user\n   },\n  }).then(function(promises) {\n    console.log('user promises', promises);\n    promises.forEach(function(promise) {\n      dbPromises.push(promise) // adds their info to dbPromises value\n    });\n    resp.send(dbPromises) // sends dbPromises back to the page\n  })\n})\n\napp.get('/promises/remove/:urtx', (req, resp) => {\n  Promise.findAll({\n   where: {\n     user: req.params.user\n   },\n  })\n})\n\n// creates a new entry in the promises table with the submitted values\napp.post('/promises', (req, resp) => {\n  console.log('promise req', req, resp);\n  Promise.create({ text: req.query.promise })\n  resp.sendStatus(200)\n})\n\napp.get('/reset', (req, resp) => {\n  setup()\n  resp.redirect('/')\n})\n\n// removes all entries from the promises table\napp.get('/clear', (req, resp) => {\n  Promise.destroy({where: {}})\n  resp.redirect('/')\n})\n\n/*\nLittle picture: Why does this error handling code not run when I surf to \na bad URL like iwill.glitch.me/foo%bar\n\nBigger picture: I'm making an app that needs to process any URL the user may \nthrow at it. I need the server to get the exact URL the way the user sees it in \nthe browser. That's going to be especially tricky for things like '#' characters\nbut right now I'm just trying to figure out the case of arbitrary '%' characters\nthat may not correspond to proper %-encodings.\n\nI'm thinking like a catchall error-handling route that no matter what weird\nencoding or whatever error is thrown I can still have the code here do something\nwith the URL as the user typed it.\n\nFor now we're just dropping all this and having the app give the user an error\nif there are any weird characters in the URL.\n\napp.use(function(req, resp, next) {\n  var err = null\n  try {\n    console.log(\"TRYING\", req.path, req.url)\n    decodeURIComponent(req.path)\n  } catch(e) {\n    err = e\n  }\n  if (err) {\n    console.log(\"CAUGHT ERR:\", err, req.url)\n    return resp.redirect('/')\n  }\n  next();\n\n  //console.log(\"DEBUG USE1:\", req.originalUrl)\n  //resp.redirect('/')\n})\n*/\n\napp.all('*', (req, resp) => {\n  // The server at promises.to passes along the full URL the way the user typed\n  // it, so when the user hits \"bob.promises.to/foo\" the Glitch app is called\n  // with \"iwill.glitch.me/bob.promises.to/foo\" and req.originalUrl is\n  // \"/bob.promises.to/foo\" (originalUrl doesn't include the hostname)\n  let urtx = req.originalUrl.substr(1) // get rid of the initial slash\n  // urtx is now, eg, \"bob.promises.to/foo_the_bar/by/9am\"\n  \n  // TODO: don't try to parse a promise if no subdomain, ie, no user given\n  // TODOLATER: how to handle \"bob.promises.to/foo%bar\"\n  // TODOLATER: need to url-decode to handle \"bob.promises.to/foo^bar\"\n  // TODOLATER: handle bob.promises.to/do_item_#2/by/9am\n  //           https://stackoverflow.com/questions/18796421/capture-anchor-links\n  \n  console.log(\"DEBUG urtx:\", urtx)\n  // Parse the urtext into user, what, whom, tini, tdue, etc\n  // Check if a promise already exists with matching user+'|'+what\n  // If not, create it\n  // If so, do nothing\n  let p = parseProm(urtx)\n  // TODO: if the url was just alice.promises.to then we want to show alice's\n  // statistics and list of promises and everything\n  if (p.user === 'www' || p.user === '') { \n    // TODO: this is the case of no username, like if someone just went to\n    // \"promises.to\" or tried to fetch \"promises.to/robots.txt\" or whatever\n    resp.sendFile(__dirname + '/public/index.html') \n  } else if (!users.includes(p.user)) {\n    // TODO: tell user \"Sorry, no such user! Get in touch if you want to get in\n    // on our beta!\"\n    resp.sendFile(__dirname + '/public/index.html')\n  } else {\n    Promise.findOne({ where: {urtx} })\n      .then(promise => {\n        if (promise) {\n          console.log('duplicate', urtx);\n          resp.redirect(`/promise/${urtx}`);\n        } else {\n          Promise.create(p);\n          mailself('PROMISE', urtx);\n        }\n    })\n \n    resp.sendFile(__dirname + '/public/index.html') \n  }\n})\n\nvar listener = app.listen(process.env.PORT, function() {\n  console.log('Promises app is listening on port ' + listener.address().port)\n})\n\n// --------------------------------- 80chars ---------------------------------->\n"
      ]
    },
    "mtime": 1506559169349
  }
}